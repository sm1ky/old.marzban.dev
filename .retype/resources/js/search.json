[[{"l":"Введение","p":["Marzban (Персидское слово \"Пограничник\" - произносится /mærz'ban/) — это инструмент управления прокси-серверами, который предоставляет простой и удобный пользовательский интерфейс для управления сотнями учетных записей прокси на базе Xray-core и созданный с использованием Python и ReactJS."]},{"i":"почему-marzban","l":"Почему Marzban?","p":["Marzban удобен в использовании, многофункционален и надежен. Он позволяет создавать различные прокси для пользователей без сложной настройки. С помощью встроенного веб-интерфейса можно контролировать, изменять и ограничивать пользователей."]},{"l":"Функции","p":["REST API бэкэнд","Автоматическая генерация Ссылок и QRcode","Возможность активации нескольких протоколов для каждого пользователя","Встроенный Command Line Interface (CLI)","Встроенный Telegram Bot","Готовый Web UI","Мониторинг ресурсов сервера и использования трафика","Настраиваемые конфигурации xray","Несколько inbound на одном порту(поддержка fallbacks)","Несколько пользователей на одном inbound","Несколько языков","Ограничение трафика по периодам(например выдавать трафик на день, неделю и т. д.)","Ограничения на основе количества трафика и срока действия","Поддержка [множества узлов] (для распределения инфраструктуры и масштабируемости)","Поддержка TLS и REALITY","Поддержка Нескольких администраторов(WIP)","Поддержка протоколов Vmess, VLESS, Trojan и Shadowsocks","Поддержка ссылок-подписок совместимых с V2ray(такие как V2RayNG, OneClick, Nekoray, и др.), Clash и ClashMeta"]},{"l":"Участники","p":["Мы ❤️‍\uD83D\uDD25 участников проекта! Если вы хотите внести свой вклад, пожалуйста, ознакомьтесь с нашим [Contributing Guidelines] и не стесняйтесь отправлять запросы на исправление ошибок или сообщить о проблеме. Мы также приглашаем вас присоединиться к нашей группе Telegram для получения поддержки.","Проверьте open issues, чтобы помочь развитию этого проекта."]}],[{"l":"Поговорим о VLESS","p":["Статья находится в режиме написания. Со временем будет дополняться и изменяться."]},{"l":"Определение","p":["VLESS- это легкий транспортный протокол, без сохранения состояния, который разделен на входящую и исходящую части и может использоваться в качестве моста между клиентом и сервером Xray.","В отличие от VMess, VLESS не зависит от системного времени.","Метод аутентификации основан на UUID"]},{"l":"Запрос и ответ","p":["1 байт","16 байт","2 байта","M байт","N байт","S байт","VLESS имеет следующую структуру запроса","VLESS имеет следующую структуру ответа","X байт","Y байт","Адресс","Версия протокола","Версия протокола, соответствующая запросу","Длина дополнительной информации M","Длина дополнительной информации N","Дополнительная информация в ProtoBuf","Запрос","Инструкции","Ответ","Порт","Соответствующий UUID","Тип адреса"]},{"l":"Режим передачи","p":["VLESS поддерживает множество режимов передачи: TCP, gPRC, H2, quic, WebSocket, mKCP. Но так как XTLS, о котором мы поговорим немногим позже, в настоящее время поддерживает только TCP, то для нас,TCP, является единственно рекомендуемым, в настоящее время, режимом передачи","Кроме того, XTLS в настоящее время поддерживает только три метода передачи: TCP, mKCP и DomainSocket. В настоящее время у VLESS нет встроенного шифрования, поэтому его необходимо использовать совместно с TLS."]},{"l":"REALITY","p":["Проект REALITY, представляет собой новаторскую разработку, являющуюся развитием и улучшением существующих технологий TLS (Transport Layer Security). Основная цель REALITY - предоставить более безопасный и эффективный способ обеспечения конфиденциальности и целостности данных при передаче через интернет. Вот ключевые аспекты, которые помогут понять, как работает REALITY:","Улучшенная Безопасность и Приватность: REALITY стремится устранить некоторые известные уязвимости и ограничения стандартного TLS. Это включает в себя устойчивость к атакам на цепочку сертификатов и уменьшение видимости отпечатков TLS, что делает его более устойчивым к блокировкам и цензуре.","Reality позволяет указывать на чужие сайты без необходимости покупки собственного домена или настройки TLS-сервера, что делает его более удобным для использования и позволяет представлять полностью реальный TLS с определенным SNI посреднику.","Совместимость с Существующими Протоколами: REALITY разработан так, чтобы быть совместимым с существующими протоколами, это означает, что он может быть интегрирован в существующие системы без необходимости кардинальных изменений, но это не рекомендуется из-за существующих и легко распознаваемых особенностей TLS в TLS.","Прозрачность для Пользователей и Серверов: Протокол предназначен для работы таким образом, чтобы быть прозрачным как для клиентов, так и для серверов, что облегчает его внедрение и использование.","Поддержка Современных Стандартов: REALITY поддерживает современные стандарты безопасности и шифрования, обеспечивая высокий уровень защиты данных.","Гибкость и Настройка: Протокол предлагает различные опции настройки для удовлетворения специфических требований безопасности и производительности.","Поговорим подробнее про каждый аспект","Устойчивость к Атакам на Цепочку Сертификатов Одна из ключевых особенностей REALITY - это улучшенная устойчивость к атакам, связанным с цепочкой сертификатов. В традиционном TLS, безопасность соединения во многом зависит от доверия к центрам сертификации (CA), которые выдают сертификаты. Атаки на цепочку сертификатов могут происходить, если злоумышленник может скомпрометировать или подделать сертификат, выданный CA. REALITY стремится уменьшить эту уязвимость, предоставляя дополнительные механизмы безопасности, которые делают такие атаки менее эффективными.","Сокрытие Отпечатков TLS: Отпечатки TLS - это уникальные характеристики, которые могут быть использованы для идентификации и блокировки определенных типов зашифрованного трафика. В странах с жесткой интернет-цензурой, например, правительства могут использовать отпечатки TLS для обнаружения и блокировки VPN-трафика. REALITY разрабатывается с целью минимизации этих отпечатков, делая трафик менее узнаваемым и, следовательно, более устойчивым к цензуре и блокировкам.4. Прямая Секретность (Forward Secrecy): Этот принцип безопасности гарантирует, что даже если ключи шифрования будут скомпрометированы в будущем, злоумышленники не смогут расшифровать прошлые сессии. REALITY поддерживает прямую секретность, обеспечивая, что каждая сессия зашифрована уникальным сеансовым ключом.","Обход Блокировок и Цензуры: Улучшенная анонимность и безопасность, предоставляемые REALITY, делают его эффективным инструментом для обхода интернет-цензуры и блокировок, особенно в режимах, где традиционные методы VPN и шифрования подвергаются ограничениям.","Эти аспекты делают REALITY мощным инструментом для повышения безопасности и приватности в интернете, особенно в условиях, когда стандартные протоколы TLS могут быть уязвимы или неэффективны."]},{"l":"XTLS"},{"i":"основная-концепция-xtls","l":"Основная концепция XTLS:","p":["Основная логика XTLS заключается в использовании настоящего TLS для маскировки прокси-трафика среди самого обычного интернет-трафика. Для обычного TLS прокси-протокола (например, оригинального Trojan), клиент прокси пользователя устанавливает настоящее TLS соединение с прокси-сервером, и через этот зашифрованный туннель приложение (например, браузер) устанавливает еще одно TLS соединение с целевым сервером (например, Google). В этот момент браузер и сервер Google обеспечивают end-to-end шифрование, и никто (включая наш прокси) не может расшифровать или подделать отправляемую информацию. Это и есть так называемое e2e.\"","Вот краткая схема: Браузер ---- Прокси-клиент ==== Прокси-сервер ---- Google","Когда прокси-данные проходят через цензора, они фактически шифруются дважды. Однако, в этом процессе, 99% трафика на самом деле не требует дополнительного шифрования. Поскольку данные, зашифрованные с помощью TLS 1.3, внешне выглядят абсолютно одинаково, цензор не может их различить. Таким образом, логика прокси должна быть следующей:","Установить настоящее TLS-соединение.","Внутри зашифрованного туннеля отслеживать коммуникацию между браузером и Google, определяя, является ли текущее соединение TLS 1.3.","Если нет, то использовать обычный метод TLS-прокси, продолжая использовать зашифрованный туннель.","Если да, то дождаться начала передачи зашифрованных данных обеими сторонами, а клиент прокси вставляет UUID в первый внутренний зашифрованный пакет, сигнализируя серверу прокси: мы готовы к 'голому' соединению!","Начиная со второго внутреннего зашифрованного пакета, XTLS больше не выполняет никаких операций с данными, а просто копирует их. Это и есть xtls-rprx-vision.","Мы можем заметить, что:","Внешний TLS, инициированный прокси, является настоящим, поэтому цензор не может его взломать.","'Голый' трафик на стороне прокси просто копируется без изменений. Если цензор попытается вмешаться, он получит стандартный ответ от браузера и сервера Google, который не будет отличаться от обычного доступа.","Сигналом для 'голого' соединения служит UUID, который является приватной информацией прокси, чтобы избежать уязвимостей, подобных тем, что были в Go#17, связанных с использованием кодовых характеристик для определения части 23 3 3.\""]},{"l":"Почти совершенно","p":["С 3 октября, в Китае, началось массовое распознавание и блокирование TLS-прокси. Из некоторых обсуждений и внутренней информации мы узнали, что цензоры использовали огромные ресурсы и методы машинного обучения. Как известно, сильная сторона машинного обучения - извлечение статистических характеристик из больших объемов данных.","Одним из важных недостатков обычного TLS-прокси является 'шифрование в шифровании'. Как обсуждалось выше, хотя внешний вид зашифрованных пакетов неотличим для цензора, неизбежным является увеличение заголовка каждого пакета с каждым уровнем шифрования. Это увеличение может быть незначительным, но для маленьких данных (например, пакетов ответов) оно может быть более заметным, и некоторые пакеты могут превышать ограничения MTU сетевого уровня. Самое важное - каждый пакет увеличивается на одинаковую длину, что может создавать определенные статистические характеристики.","XTLS изначально был разработан , чтобы уменьшить дополнительное шифрование. Новый потоковый контроль Vision был введен, потому что XTLS обладает уникальной способностью противостоять цензуре. Можно сказать, что когда передаются данные TLS 1.3, 99% пакетов XTLS имеют почти идеальные характеристики трафика, потому что это оригинальные данные, не обработанные прокси."]},{"l":"TLS в TLS","p":["Почему мы говорим, что 99% пакетов являются оригинальными данными? Что представляют собой оставшиеся 1%? Нам нужно исследовать, что происходит в типичном прокси при встрече с трафиком TLS 1.3 в первых нескольких пакетах.","Наглядно, после установления зашифрованного канала:","Первый пакет: Прокси-клиент -> Прокси-сервер: \"Привет, цель этого прокси-сессии - Google, вот мой UUID.\"","Второй пакет: Прокси-клиент <- Прокси-сервер: \"Привет, получил твой запрос на прокси, начинай отправлять данные.\"","Третий пакет: Браузер -> Прокси-клиент -> Прокси-сервер -> Google: \"Привет, Google, я собираюсь начать с тобой зашифрованное общение, вот мои поддерживаемые методы шифрования...\" (Этот пакет также называется TLS Client Hello).","Четвертый пакет: Браузер <- Прокси-клиент <- Прокси-сервер <- Google: \"Привет, пользователь, вот сертификат Google, мы будем использовать шифрование TLS_AES_128_GCM_SHA256, давай начнем зашифрованное общение!\" (Этот пакет также называется TLS Server Hello).","Пятый пакет: Браузер -> Прокси-клиент -> Прокси-сервер -> Google: \"Понял, давай начнем зашифрованное общение!\"","Как вы знаете, протоколы прокси разнообразны, но основа одна и та же: если пользователь использует любое TLS-соединение, необходимо выполнить вышеупомянутый процесс рукопожатия. Как упоминалось ранее, внешнее TLS-шифрование можно считать абсолютно безопасным, но для цензора, помимо взлома информации, есть возможность использовать некоторые дополнительные данные для идентификации этих пяти пакетов.","Это ключевые моменты обнаружения TLS в TLS.\""]},{"l":"Пять пакетов","p":["Самой очевидной характеристикой этих пяти пакетов является их длина. В частности:","Первый пакет: очень короткий, единственная переменная - целевой адрес.","Второй пакет: очень короткий, почти фиксированный.","Третий пакет: короткий, с небольшими изменениями, почти единственная переменная - целевой SNI.","Четвертый пакет: длинный, с большими изменениями.","Пятый пакет: очень короткий, с небольшими изменениями.","Можно интуитивно почувствовать, что характеристики длины этих пакетов довольно очевидны. В Vision подход к решению этой проблемы также прост: мы увеличиваем длину каждого короткого пакета до диапазона от 900 до 1400. Обратите внимание, что этот метод отличается от традиционного случайного заполнения; мы не просто добавляем заполнение ко всем пакетам, а основываясь на нашем анализе внутреннего трафика, целенаправленно заполняем характерные пакеты TLS-рукопожатия.","Другой менее заметной характеристикой является временная последовательность. Из-за дизайна TLS-рукопожатия можно заметить, что порядок первых нескольких пакетов фиксирован. То есть, после отправки браузером TLS Client Hello, он должен дождаться ответа Google с TLS Server Hello, после чего браузер должен отправить сообщение \"Понял, давай начнем зашифрованное общение!\", чтобы диалог мог продолжаться.","Если обозначить пакеты, идущие от пользователя к серверу, как C, а в обратном направлении - как S, может ли цензор определить TLS в TLS соединение по временной последовательности данных CSCSC и их временным интервалам? пока недостаточно оснований для таких выводов, и Vision не обрабатывает этот аспект.\""]},{"l":"Часто задаваемые вопросы"},{"i":"длина-заполнения-в-vision-зафиксирована-не-создает-ли-это-статистические-характеристики","l":"Длина заполнения в Vision зафиксирована, не создает ли это статистические характеристики?","p":["В первую очередь, в концепции сетевой безопасности нет абсолютной безопасности, теоретически любое шифрование можно взломать силой, это лишь вопрос вычислительных ресурсов. Как разработчики безопасных протоколов, наша задача - повысить сложность взлома и обнаружения до уровня, недостижимого для цензоров. Насколько высок этот уровень? Это мы узнаем в ходе борьбы.","Возвращаясь к известным нам данным, длина пакетов рукопожатия TLS 1.2 и 1.3 довольно стабильна. Несколько ключевых пакетов, посещающих основные сайты (например, Google), можно считать фиксированной длины. Если сравнить текущую длину больших пакетов Vision с длиной незаполненных рукопожатий, сложность обнаружения, вероятно, увеличится на порядок.","Кроме того, в некоторых утечках обсуждений упоминалось, что машинное обучение может распознавать случайное заполнение менее 40%. Это косвенно подтверждает наличие предела распознавания у машинного обучения.\""]},{"i":"почему-новый-потоковый-контроль-назван-vision","l":"Почему новый потоковый контроль назван Vision?","p":["Ответ: Мы считаем, что Vision отражает первоначальную концепцию дизайна RPRX. XTLS первоначально разрабатывался в процессе исследования и был ограничен тогдашними условиями разработки, что делало некоторые аспекты слишком сложными. Таким образом, Vision представляет идеальное состояние и будущее направление XTLS. RPRX говорит:\"Flow.. Какую проблему он решает? Он влияет на макроскопические временные характеристики трафика, а не на микроскопические, которые являются задачей шифрования. Временные характеристики трафика могут быть вызваны протоколом, например, Socks5 over TLS с рукопожатием Socks5, разные характеристики на уровне TLS означают разные протоколы для наблюдателя, таким образом, бесконечные планировщики (Schedulers) эквивалентны бесконечному количеству протоколов (перераспределение объема данных для каждой отправки и т.д.)\""]},{"i":"этот-новый-потоковый-контроль-так-хорош-рекомендуете-ли-вы-всем-использовать-его-для-обхода-блокировок","l":"Этот новый потоковый контроль так хорош, рекомендуете ли вы всем использовать его для обхода блокировок?","p":["Ответ: Как говорят другие разработчики, для текущих цензоров опасно класть все яйца в одну корзину. Поэтому мы рекомендуем активно использовать особенности каждого инструмента и разнообразить ваш набор инструментов.\""]}],[{"i":"как-работает-интернет","l":"Как работает интернет?"},{"l":"Описание","p":["Мы углубимся в основы работы Интернета, предоставив всеобъемлющий обзор для полного понимания этой сложной и постоянно развивающейся технологии. Я помню, как мой отец объяснял мне интернет, когда мне было пять лет: Малыш! Интернет похож на большой город, где каждый компьютер - это дом, а интернет-кабели - это как улицы и дороги, соединяющие их. Как вы можете использовать улицы, чтобы добраться из одной части города в другую, вы можете использовать Интернет для доступа к информации и общения с людьми со всего мира.","Интернет можно считаться огромным городом с многочисленными дорогами, ведущими в различные пункты назначения по всему миру. Чтобы посетить определенное место в Интернете, вы используете свой компьютер для подключения к соответствующей дороге и перехода к нужному месту назначения. Для этого ваш компьютер взаимодействует с другими компьютерами, чтобы определить маршрут, по которому нужно идти, а затем следует по этому маршруту, чтобы добраться до места назначения. URL-адреса (Uniform Resource Locators) - это адреса, которые люди используют для доступа к определенным местоположениям в Интернете. Они состоят из комбинации букв и цифр, и обычно они начинаются с \"http://\" или \"https://\", за которыми следует доменное имя. Домены легко запомнить и ввести в веб-браузер, поэтому они так часто используются. С другой стороны, компьютеры предпочитают использовать IP-адреса для доступа к определенным местоположениям в Интернете. IP-адрес - это числовая метка, назначенная каждому устройству, подключенному к компьютерной сети, которая использует Интернет-протокол для связи. IP-адреса состоит из серии чисел, разделенных точками, и они позволяют компьютерам общаться друг с другом, отправляя данные туда-сюда между своими IP-адресами. В то время как людям удобнее использовать URL-адреса, компьютеры могут легче взаимодействовать друг с другом, используя IP-адреса. Вот почему за кулисами URL-адреса преобразуются в IP-адреса DNS-серверами, когда вы вводите URL-адрес в свой веб-браузер. DNS-сервер действует как телефонная книга для Интернета, содержащая список всех URL-адресов для различных мест и соответствующих им адресов, известных как IP-адреса. Интернет-цензура часто начинается с фильтрации DNS-запросов. Этот процесс включает в себя блокировку или перенаправление DNS-запросов для определенных веб-сайтов или интернет-адресов. Когда пользователь пытается получить доступ к цензурированному веб-сайту, DNS-запрос для этого веб-сайта перехватывается и либо блокируется, либо перенаправляется в другое место. Это не позволяет пользователю получить доступ к предполагаемому веб-сайту и эффективно подвергает его цензуре доступ к определенной информации в Интернете. Фильтрация DNS-запросов является распространенным методом цензуры, потому что он относительно прост в реализации и может быть трудным для пользователей."]}],[{"l":"Поговорим о DNS"},{"l":"Описание","p":["Когда вы используете свой компьютер, чтобы зайти на сайт в Интернете, он сначала отправляет сообщение на DNS-сервер и запрашивает IP-адрес места, куда вы хотите пойти. DNS-сервер ищет URL-адрес в своем списке и находит IP-адрес устройства, на котором размещено этот сайт. Затем он отправляет IP-адрес обратно на ваш компьютер. Затем ваш компьютер может использовать этот IP-адрес для связи с устройством и запроса информации, необходимой для отображения сайта, куда вы хотите зайти. Подобно тому, как GPS помогает вам найти свой путь к определенному адресу в городе, используя названия улиц и номера, DNS позволяет вашему компьютеру находить IP-адрес веб-сайтов в Интернете, используя название веб-сайта. Например, если вы хотите посетить веб-сайт вашей любимой кофейни, DNS может помочь вашему компьютеру, превязув имя сайта (например, starbucks.com) в IP-адрес, который он должен подключиться (например, 23.37.62.10). Давайте представим, что вы дома, просите маму взять латте в Starbucks. После использования GPS для указания маршрута она направляется в Starbucks, принимает ваш заказ и возвращается домой. Когда вы набираете \"www.starbucks.com\" в своем браузере, это все как сказать: \"Эй, мама, купи мне кофе в Starbucks\". Браузер запрашивает у DNS-сервера (GPS) IP-адрес основного сервера Starbucks, прежде чем добраться до него. Затем сервер отправляет обратно запрошенные данные (ваш кофе). Но DNS-сервер может лгать! Представьте, что ваша мама спросила у GPS дорогу, и это дало ей неправильную информацию, поэтому она в конечном итоге пошла по кругу. Каждый DNS-запрос отслеживается, фильтруется и переписывается цензорами как первый уровень цензуры. Это означает, что они могут показывать вам предупреждающие страницы вместо запрошенных данных. Это все как заблудиться в городе и оказаться в никуда или быть доставленным в место, где полицейские могут, по крайней мере, получить ваш номерной знак. Это похоже на то, что преступники делают с подделкой DNS ( https://en.wikipedia.org/wiki/DNS_spoofing). Поэтому всегда будьте осторожны при использовании DNS-серверов и доверяйте им экономно! В 2011 году правительственные хакеры Ирана использовали отравление кэшем DNS (наряду с SSL-сертификатами от DigiNotar) для шпионаже за учетными записями Gmail оппозиции. С помощью сертификатов DigiNotar они настраивают поддельный сервер с действительным сертификатом *.google.com и, отравляя DNS-сервер, перенаправляю на него жертв. ( https://www.computerworld.com/article/2738861/google-says-gmail-attack-focused-on-iranian-targets.html) Это позволило им тайно следить за деятельностью оппозиции по электронной почте без их ведома. Это была подлая и закучная тактика, показывающая, как далеко некоторые правительства пойдут, чтобы контролировать и подвергать цензуре Интернет. Если вам интересно, прочитайте о захвате DNS ( https://www.cloudflare.com/learning/security/global-dns-hijacking-threat/). Цензоры могут манипулировать и перенаправлять ваши интернет-запросы на свой собственный цензурированный DNS-сервер без вашего ведома, что может помешать вам получить доступ к нужной информации. Использование общедоступного DNS-сервера также может быть неэффективным в этих ситуациях. Протокол DNS, который использует UDP-порт 53, уязвим для цензуры, потому что его относительно легко заблокировать. Именно здесь могут быть полезны виртуальные частные сети (VPN), так как они могут защитить ваше интернет-соединение и позволить вам получить доступ к ограниченной информации."]}],[{"l":"Поговорим о цензуре"},{"l":"Описание","p":["Интернет-цензура относится к ограничению доступа к информации в Интернете. Она может принимать различные формы, от блокировки определенных веб-сайтов или услуг до фильтрации контента для удаления определенной информации. Выявление и предотвращение доступа к запрещенному контенту является приоритетом для некоторых правительств. Интернет-цензура часто оправдана как средство защиты национальной безопасности, предотвращения распространения вредного или незаконного контента или продвижения социальных ценностей. Тем не менее, многие критики утверждают, что цензура может быть использована для подавления политического инакомыслия и ограничения свободы выражения мнений. Технически, интернет-цензура поднимает одни и те же вопросы независимо от того, кто ее заказывает. Независимо от того, уполномочен ли это судом, \"независимым\" органом или правительством, цензура ограничивает доступ к информации и свободу выражения мнений."]},{"l":"Технологии Цензуры","p":["Существуют различные способы реализации интернет-цензуры. Одним из распространенных методов является использование фильтрации DNS-запросов. Этот метод включает в себя изменение запросов DNS (системы доменных имен) пользователей, чтобы предотвратить их доступ к определенным веб-сайтам или типам контента. Интернет-цензура также может быть реализована с помощью технологий наблюдения, таких как программное обеспечение для мониторинга и глубокая проверка пакетов (DPI). Эти технологии позволяют правительствам и другим организациям контролировать интернет-активность и выявлять пользователей, которые получают доступ к запрещенному контенту или участвуют в запрещенной онлайн-активности. Великий брандмауэр Китая (GFW) - это система интернет-цензуры и слежки, внедренная китайским правительством. Он предназначен для блокировки или ограничения доступа к определенным веб-сайтам и интернет-сервисам, которые правительство считает неуместными или вредными. GFW использует различные методы для цензуры Интернета, включая фильтрацию DNS, блокировку ключевых слов и блокировку IP-адресов. Он считается одной из самых передовых и всеобъемлющих систем интернет-цензуры в мире. Есть много аргументов в пользу и против интернет-цензуры. Те, кто выступает за цензуру, часто утверждают, что необходимо защищать национальную безопасность, предотвращать распространение вредного или незаконного контента и продвигать социальные ценности. Те, кто выступает против цензуры, утверждают, что она ограничивает свободу выражения мнений и может быть использована для подавления политического инакомыслия."]}],[{"i":"что-такое-vpn","l":"Что такое VPN?"},{"i":"как-работает-vpn","l":"Как работает VPN?","p":["Представьте, что вы хотите посетить определенный веб-сайт, но кто-то или что-то пытается помешать вам получить к нему доступ. Это может быть сделано с помощью методов интернет-цензуры, таких как блокировка или перенаправление вашего DNS-запроса на веб-сайт. VPN может помочь вам обойти этот блок и посетить веб-сайт, который вы хотите. Он создает уникальное соединение между вашим компьютером и другим компьютером, на расстоянии. Когда вы используете это специальное соединение, вы объезжаете квартал и въезжаете с другого направления. Чтобы объяснить это, давайте продолжим с метафорой дорог и улиц. Представьте, что некоторые улицы города заблокированы или непроходимы. Несмотря на это, твоя мама хочет купить тебе кофе в Starbucks. Она может использовать объезды и более длинные маршруты, чтобы добраться до места назначения. Аналогичным образом, Интернет предоставляет несколько маршрутов в любой пункт назначения. Чтобы использовать виртуальную частную сеть (VPN), вы должны подключиться к серверу, управляемому VPN-провайдером в месте без интернет-цензуры. Этот сервер функционирует как посредник между вашим устройством и Интернетом. Он получает ваш интернет-трафик и направляет его через IP-адрес сервера."]},{"i":"является-ли-vpn-безопасным","l":"Является ли VPN безопасным?","p":["Одна из потенциальных проблем с традиционными VPN заключается в том, что они направляют ваш интернет-трафик только через один сервер. Хотя это может помочь защитить вашу онлайн-активность и IP-адрес от видимости третьими лицами, это не гарантирует полную анонимность. Даже если вы используете VPN-провайдера, который утверждает, что не имеет журналов вашей активности, или вы создаете свой собственный VPN на частном VPS, ваша онлайн-активность все равно может быть отслежена. Это связано с тем, что интернет-провайдеры (провайдеры интернет-услуг) могут вести собственные журналы, которые могут быть использованы для идентификации вас на основе времени и даты вашей онлайн-активности. Например, предположим, что вы оставляете отрицательный комментарий на правительственном веб-сайте при подключении к VPN. В этом случае ваш фактический IP-адрес можно отследить, сопоставив время инцидента с конкретным пользователем, который был подключен к определенному VPN одновременно. Вот почему некоторые эксперты считают, что VPN могут обеспечить ложное чувство безопасности."]}],[{"l":"Недостатки VPN"},{"l":"Потенциальные недостатки маршрутизации всех интернет-соединений через VPN","p":["Понимание того, что не весь интернет-трафик должен отправляться через VPN по разным причинам, имеет решающее значение. Первая причина заключается в том, чтобы не иметь весь трафик из одного и того же места. Когда вы используете VPN для всех своих подключений, цензоры могут видеть, что весь ваш трафик входит и покидает один адрес. Это может облегчить им блокировку IP-адреса вашего VPN сервераили даже доставить вам неприятности из-за обхода их цензуры. Поэтому важно быть стратегическим в том, как вы используете VPN, и использовать их только для определенных типов трафика. В дополнение к проблеме трафика 1:1, есть и другие причины, по которым вы не должны использовать VPN для всего вашего интернет-трафика. Многие приложения и сервисы размещаются в границах конкретной страны. В случае с Ираном многие местные приложения и сервисы требуют, чтобы вы отключили VPN. Кроме того, это как путешествовать туда-сюда между разными странами, чтобы получить кофе из двух кварталов. Поэтому использование VPN для всего вашего интернет-трафика может быть неудобным и ненужным. Есть и другие важные причины, по которым вы должны использовать VPN только для некоторого интернет-трафика. Например, может быть подозрительно, на банковских и торговых сайтах, увидеть, что вы вошли в систему из другой страны. Злоупотребление VPN заставило некоторые сайты заблокировать их. Это может повлиять даже на такие простые вещи, как поиск в Google. Те, кто играет, могут заметить увеличение задержки, потому что их мама использует более длительный и круговой путь, чтобы выпить кофе. Предположим, вы рассматриваете подключение и отключение от VPN в качестве обходного пути для вышеуказанных проблем. В этом случае вы должны знать, что это может быстро стать хлопотой. Поначалу это может показаться простым, но переключение между VPN и обычными интернет-соединениями может быть утомительным и трудоемким. настройка каждого устройства для использования VPN решит все эти проблемы."]}],[{"l":"Установка"},{"l":"Быстрая установка","p":["Выполните быструю установку, используя следующую команду:","После завершения установки:","Файлы Marzban будут находиться в директории /opt/marzban.","Файл конфигурации будет находиться в /opt/marzban/.env.","Данные будут размещены в /var/lib/marzban.","Доступ к панели управления осуществляется через http://YOUR_SERVER_IP:8000/dashboard/(замените YOUR_SERVER_IP на IP-адрес вашего сервера).","После установки, для остановки вывода логов воспользуйтесь комбинацией Ctrl+C или закройте терминал.","Для создания учетной записи главного администратора и доступа к панели управления Marzban выполните:","Теперь вы можете войти, используя данные вашей учетной записи.","Чтобы получить справку по использованию скрипта Marzban, введите команду:"]}],[{"l":"Получение SSL","p":["Рекомендуется получить и настроить SSL сертификат для обеспечения безопасности передачи данных панели и защиты от атак \"человек-по-середине\", работы TLS подключений, функционирования подписок и многого другого.","Для доступа Marzban к файлам сертификатов они должны быть размещены в /var/lib/marzban/certs.","Перед получением SSL-сертификата настройте DNS-записи вашего домена (A и/или AAAA записи).","Если вы только что зарегистрировали домен и добавили DNS-записи, возможно, потребуется время для их обновления. Статус можно проверить на https://www.whatsmydns.net.","Для новых и существующих доменов рекомендуется использовать NS сервера Cloudflare и управлять DNS-записями через их сервисы."]},{"i":"получение-сертификата-с-acmesh","l":"Получение сертификата с acme.sh"},{"l":"Установка необходимого ПО"},{"i":"установка-acmesh","l":"Установка acme.sh","p":["EMAIL — ваш email (можно указать любой)."]},{"l":"Создание директории для сертификатов"},{"l":"Получение сертификатов","p":["Замените DOMAIN на ваш домен или субдомен."]},{"i":"получение-wildcard-сертификата-с-acmesh","l":"Получение wildcard сертификата с acme.sh","p":["Если вам нужны wildcard сертификаты для всех поддоменов."]},{"i":"установка-необходимого-по-1","l":"Установка необходимого ПО"},{"i":"установка-acmesh-1","l":"Установка acme.sh","p":["EMAIL — ваш email (можно указать любой)."]},{"i":"создание-директории-для-сертификатов-1","l":"Создание директории для сертификатов"},{"l":"Получение ключа API Cloudflare","p":["Получите Global API Key в аккаунте Cloudflare для автоматической настройки DNS-записей."]},{"l":"Настройка переменных окружения"},{"l":"Выпуск wildcard сертификата","p":["Замените DOMAIN на ваш домен.","Для просмотра списка выпущенных сертификатов:","Для ручного продления сертификатов:"]}],[{"l":"Подключение SSL"},{"l":"Подключение SSL сертификатов","p":["Если включить SSL в Marzban, панель управления и ссылка на подписку будут доступны через https.","Во всех примерах ниже вы можете найти файлы docker-compose.yml и .env по пути /opt/marzban‍‍‍, а xray_config.json по пути /var/lib/marzban"]},{"l":"SSL с помощью Uvicorn","p":["Marzban запускается по умолчанию с помощью Uvicorn, он же позволяет вам определять файлы сертификатов SSL.","После создания файлов сертификатов SSL установите в файле .env следующие переменные .","YOUR_DOMAIN- ваш домен или субдомен","Изменяем в нем следующие переменные","знак # в начале каждой изменяемой переменной нужно удалить, иначе значение переменной не будет установленно, так как будет считаться закомментированным","если Вы испольузете wildcard домен, Вы можете использовать установить знак * в переменной XRAY_SUBSCRIPTION_URL_PREFIX, например https://*.DOMAIN.com, вместо которого, система будет подставлять случайное значение, например https://830aa395df41ae5a.DOMAIN.com","Сохраняем внесенные изменения.","Для того, что бы изменения вступили в силу, необходимо перезапустить панель","Теперь панель управления Marzban будет доступна на вашем домене или субдомене по https."]}],[{"l":"Первое знакомство"},{"l":"Первое знакомство с панелью","p":["По факту выполнения предыдущих шагов, Вам будет доступна панель управления, где Вы сможете увидеть всю статистику, сможете управлять панелью, подключениями пользователей и соьственно самими пользователями, а так же, при необходимости, подключить дополнительные узлы."]},{"i":"раздел-основные-настройки","l":"Раздел \"Основные настройки\"","p":["В данном разделе, Вы сможете отредактировать свой xray_config.json через удобный Web-UI. Так же, в этом разделе, Вы сможете увидеть RealTime логи и перезагрузить ядро."]},{"i":"раздел-настройки-хоста","l":"Раздел \"Настройки хоста\"","p":["В данном разделе, Вы сможете настроить ваши inbound через удобный Web-UI."]},{"i":"раздел-настройки-узла","l":"Раздел \"Настройки узла\"","p":["В данном разделе Вы сможете добавлять/удалять/изменять дополнительные узлы основной панели Marzban."]}],[{"l":"Создание пользователей"},{"l":"Создание пользователя","p":["Для создания нового пользователя, Вам будет необходимо нажать на клавишу СОЗДАТЬ на главном экране панели. доступны следующие поля для редактирования:"]},{"l":"Имя пользователя","p":["минимум 3 символа, на английском языке"]},{"l":"Лимит трафика","p":["Числовое значение, в гигабайтах. Если значение не установлено - ограничение не устанавливается"]},{"l":"Период сброса трафик","p":["Период, по истечению которого, лимит трафика будет сброшен и начат заного","Ежедневно","Еженедельно","Ежемесячно","Ежегодно"]},{"l":"Дата истечения срока","p":["Дата, в пределах которой пользователь сможет пользоваться подключением. Если значение не установлено - ограничение не устанавливается","Ежедневно","Еженедельно","Ежемесячно","Ежегодно"]},{"l":"Протоколы","p":["Нет нужды присваивать пользователю все доступные протоколы, добавляйте только то, что эфеективно на данный момент для ваших задач.","Доступные пользователю протоколы и транспорты для подключения."]},{"l":"Редактирование пользователя","p":["После создания пользователя Вам будет доступно редактирования его параметров, а так же дополнительные функции"]},{"i":"значок-корзина","l":"Значок \"Корзина\"","p":["Удалить пользователя"]},{"i":"значок-диаграм","l":"Значок \"Диаграм\"","p":["Посмотреть статистику потребления пользователя"]},{"i":"кнопка-сбросить-трафик","l":"Кнопка \"Сбросить трафик\"","p":["Ручной сброс лимита потребления трафика"]},{"l":"Отозвать подписку","p":["Сгенерировать новую ссылку-подписку, старая больше не будет доступна. Остальные парметры остаются неизменными."]},{"l":"Распространение конфигов","p":["После создания пользователя Вы сможе передать ему данные для подключения несколькими путями"]},{"l":"Подписка","p":["Предоставление данных для подключения с помощью подписки, является на данный момент самым лучшим способом распространения. Обуславливается это тем, что дает возможность динамически изменять на сервере эти самые данные для подключенния, без необходимости для пользователя каждый раз перекачивать конфиги. Формат вывода подписки устанавливется автоматически, в зависимости от приложения-потребителя:","Браузер - выводим страничку со статистикой и другой информации","Clash - отдаем подписку формата Clash","Singbox - отдаем подписку формата Singbox","v2ray - отдаем подписку формата v2ray"]},{"l":"Текст","p":["Данные для подключения Plain текстом"]},{"l":"QR-код","p":["Данные для подключения выводим графически, с помощью QR"]}],[{"l":"Настройки хоста"},{"l":"Описание","p":["С помощью настроек хоста вы можете создавать специальные конфигурации для каждого входящего соединения. Каждая конфигурация может иметь свои специфические параметры. В настройках хоста доступны следующие поля для редактирования:","Примечание","Адрес","Порт","SNI (Имя сервера)","Хост","Secutity Layer (TLS, None)","ALPN (h2, http/1.1)","Fingerprint","С помощью настроек в этом разделе вы можете настроить порт соединения, SNI, хост и т.д. по своему усмотрению.","По умолчанию, IP-адрес сервера используется в качестве значения для поля Address, а настройки по умолчанию для входящего соединения (порт и т.д.) устанавливаются для каждой конфигурации.","Настройки хоста имеют более высокий приоритет по сравнению с другими настройками.","Значения, заданные в этом разделе, имеют наивысший приоритет при создании конфигураций."]},{"l":"Переменные","p":["Для максимальной настраиваемости конфигураций предусмотрены переменные для каждого поля. В каждом поле необходимо использовать переменные этого же поля.","Переменные размещаются в { ... }","Если у вас есть переменная \"SERVER_IP\", и вы хотите использовать ее в поле \"Адрес\", вам нужно написать {SERVER_IP} в поле \"Адрес\"."]},{"l":"Описание переменных","p":["{DATA_LEFT}","{DATA_LIMIT}","{DATA_USAGE}","{DAYS_LEFT}","{EXPIRE_DATE}","{JALALI_EXPIRE_DATE}","{SERVER_IP}","{STATUS_EMOJI}","{TIME_LEFT}","{TRANSPORT}","{USERNAME}","\uD83D\uDCC6 DAYS LEFT: {DAYS_LEFT}","\uD83D\uDCCA DATA USE: {DATA_USAGE}","Дата истечения срока","Дата истечения срока по солнечному календарю","Имя пользователя","Использованный трафик","Используя эти переменные, вы можете делать, например, следующее:","Лимит трафика","Описание","Оставшееся время использования","Оставшееся кол-во дней","Оставшийся трафик","Переменная","Статус пользователя в виде смайлика (✅,⌛️,\uD83E\uDEAB,❌)","Текущий IP адрес сервера","Транспорт (e.g WS)"]},{"l":"Случайные значения","p":["В некоторых случаях требуется, чтобы часть полей (например SNI и Host) генерировалась случайным образом. Эта техника используется для предотвращения большого количества соединений к конкретному поддомену. В этом случае каждый пользователь будет подключаться к случайному поддомену.","Чтобы использовать эту функцию, используйте символ *, в полях SNI и Host.","Обратите внимание, что в этом случае также необходимо настроить соответствующие настройки для wildcard-домена.","Например:","*.example.com","32ks0ef23402.example.com","access-*.example.com","access-laks038fn201.example.com"]},{"l":"Несколько хостов и SNI","p":["Если необходимо установить несколько разных адресов для Host и SNI, вы можете разделить эти адреса с помощью ,","Один из этих адресов будет выбран случайным образом."]}],[{"l":"Настройки узла","p":["Если Вы не планируете использовать дополнительные узлы (например для расширения географии Вашего сервиса), можете пропустить данный этап","Узел - продолжение вашего сервиса и расширение существующей, центральной панели, дублировать установку панели на сервер узла не нужно."]},{"l":"Введение","p":["Marzban Node- это приложение на Python, предоставляющее сервис для управления экземпляром ядра Xray. Оно использует RPyC для удаленных вызовов процедур и Docker для контейнеризации. Приложение разработано с учетом требований безопасности и использует самоподписанные SSL-сертификаты для связи между сервисом и его клиентами. С помощью этого руководства вы можете создать узел Marzban Node на дополнительном сервере и подключить его к панели.","В связи с изменением принципа взаимодействия между Центральной панелью и Узлом, и переходом на mTLS, алгоритм подключения узла к центральной панели теперь отличается от уже всеми нами привычного."]},{"l":"Отличие TLS от mTLS","p":["старый TLS новый mTLS"]},{"l":"Установка"},{"l":"Получение ключа","p":["Открываем настройка узлов и переходим в меню добавление нового узла.","Скачиваем сертификат в файловую систему вашего устройства по нажатию на кнопку скачать сертификат или, как еще один вариант, вы можете нажать значок просмотреть и скопировать полученное значение.","Теперь переходим на наш узел."]},{"l":"Настройка узла","p":["Обновляем сервер","Устанавливаем нужный софт","Клонируем репозиторий","Входим в рабочую папку узла","Устанавливаем Docker","Создаем папку, куда поместим наш сертификат","Теперь нам необходимо разместить ключ центальной панели на узле, для этого мы можем скопировать ранее полученный ключ по пути /var/lib/marzban-node/ssl_client_cert.pem","если Вы скопировали значение ключа ранее просто вставив его в нужный файл.","Обьявляем в docker-compose.yml файле нашего проекта, о используемых сертификатах, открыв его через nano","приведя его к такому виду:","После этого, теперь, Вы сможете запустить узел.","Теперь вернемся в основную панель"]},{"l":"Настройка панели","p":["Открываем настройки узлов","Заполняем данные узла:","Name - Имя узла;","Adress - IP адрес/домен/поддомен узла.","Port - Оставляем по умолчанию, если не изменяли их.","Оставляем галку, если хотим добавить узел в качестве нового хоста во все входящие","Жмем Добавить узел","Если Вы не нажали галку добавить узел в качестве нового хоста во все входящие, Вы всегда сможете добавить узел в любой inbound, после ее подключения, просто указав ее адрес (IP или домен/суб-домен)"]},{"l":"Использование ноды на нескольких панелях","p":["/var/lib/marzban-node/server_1.pem","/var/lib/marzban-node/server_2.pem","2000","2001","3000","3001","Node-1","Node-2","SERVICE PORT","XRAY API PORT","И добавляем наши узлы исходя из вышеперечисленных данных","Иногда, может возникнуть потребность запуска нескольких экзепляров узла на одном сервере, для подключения к нескольким панелям. Для этого получаем сертификаты панели, и размещаем их на узле в папке /var/lib/marzban-node/.","Например:","Переменная","После необходимо отредактировать файл docker-compose.yml следующим образом","После перезагрузки контейнера,мы будем иметь следующее:","Сертификат Панель 1:","Сертификат Панель 2:"]},{"l":"Использование ноды на нескольких панелях с использованием Port Mapping","p":["2000","2001","2053, 2054","2096, 2097","3000","3001","Inbound PORTS","SERVICE PORT","XRAY API PORT","В этом случае для каждого экземпляра узла доступны только определенные порты, что предотвращает их повторение. Обратите внимание, что вы должны указать порты, используемые в ваших входящих соединениях, в файле docker-compose.yml, как показано в примере. Используйте следующий пример для добавления двух сервисов нода в файл docker-compose.yml:","Панель 1","Панель 2","Переменная","Порты подключения узлов к панелям и порты, доступные для входящих соединений, будут следующими:","После получения необходимых сертификатов от панелей и размещения их в указанных местах, запустите узлы.","Пример настройки файла docker-compose.yml"]},{"l":"Дополнительные советы","p":["Совет первый Если для лучшего управления узлами вы хотите назначить каждому узлу отдельный inbound, вам нужно добавить новый inbound с уникальным тегом и портом в настройках ядра (Core Settings).","Совет третий Если вы планируете использовать конфигурации с TLS, вам нужно получить сертификат для вашего суб-домена узла. Кроме того, вместо нескольких сертификатов для разных субдоменов, вы можете получить один Wildcard сертификат для основного домена, чтобы использовать его для всех субдоменов.","Совет четвертый Файл docker-compose.yml чувствителен к выравниванию строк и пробелам. Для проверки правильности настройки вы можете использовать инструмент yamlchecker.","Совет пятый Если вы внесли изменения в файл docker-compose.yml, перезапустите узлы с помощью следующей команды:"]}],[{"l":"Telegram бот","p":["Если Вы не планируете использовать встроенный telegram бот, Вы можете пропустить данный этап","Дополнительно, для взаимодействия с панелью Marzban, ее управлением и получением важных системных уведомлений, Вы можете активировать администраторский телеграм бот.","Данный бот не предназначен для продажи подписок.","Если Вы хотите осуществлять коммерческую деятельность, испольуйте любое другое, стороннее решение."]},{"l":"Получения бот токена","p":["Для создания бота и получения токена, воспольуемся силами стандартного бота BotFather Запускаем бота, командой /start","Придумываем имя нашего бота и его публичный адрес содержаший в конце bot или _bot","Например:mytestmarzban _bot","На выходе мы получаем сообшение, содержащее в себе токен Запишем это значение и перейдем к дальнейшей настройке."]},{"i":"получение-ids-администратора","l":"Получение ID(s) администратора","p":["Так как доступ к данному боту будет доступен только Вам или ограниченному списку администраторов, нам необходимо явно указать Telegram ID людей допущеных к его использованию.","Для получения своего Telegram ID, воспольуемся силами MyID bot Запускаем бота и выполняем команду /getid На выходе мы получаем сообшение, содержащее в себе наш ID.","Запишем это значение и перейдем к дальнейшей настройке."]},{"l":"Настройка .env","p":["Теперь нам нужно указать все эти данные в Marzban, для этого нам нужно задать соотвествующие переменные в файле .env раскоментировав их или добавив в конец файла, присвоив им значения полученные ранее.","Переменная","Значение","TELEGRAM_API_TOKEN","обязательно API токен полученный в BotFather","TELEGRAM_ADMIN_ID","обязательно ID администратора, если нужно дать доступ нескольким администраторам, укажите их ID через запятую","TELEGRAM_LOGGER_CHANNEL_ID","не обязательно Канал под логи","TELEGRAM_DEFAULT_VLESS_FLOW","не обязательно Стандартное значение потока VLESS , выставляемое пользователю при его создании чере бота","TELEGRAM_PROXY_URL","не обязательно Адрес ТГ прокси","После, для того что бы изменения вступили в силу, необходимо перезапустить Marzban"]},{"l":"Запуск","p":["После перезапуска Marzban Вы сможете перейти в ранее созданный Вами бот, и начать его использование."]}],[{"l":"Бэкап","p":["Необходимо регулярно создавать резервные копии ваших файлов Marzban, чтобы предотвратить потерю данных в случае сбоев системы или случайного удаления.","Если Вы не планируете использовать авоматические бекапы (или используете собственные решения), можете пропустить данный этап"]},{"l":"Бекап вручную","p":["По умолчанию все важные файлы Marzban сохраняются в папке /var/lib/marzban","Скопируйте всю папку /var/lib/marzban в место для резервного копирования по вашему выбору, например на внешний жесткий диск или облачное хранилище.","Кроме того, убедитесь, что вы создаете резервные копии вашего файла env, который содержит вашу конфигурацию, а также файла конфигурации Xray.","По умолчанию, env и другие конфигурации находятся внутри папки /opt/marzban/"]},{"l":"Автоматический бекап","p":["С помощью стороннего скрипта от AC-Lover вы сможете создавать резервные копии важной информации, из marzban и отправлять ее в Telegram при помощи бота, чтобы она всегда была доступна!","Как альтернативу Вы можете рассмотреть другой скрипт","M03ED-Backup","Скачиваем скрипт на сервер и запускаем его","Введите токен вашего бота, который будет выполнять эту задачу,","Токен бота вы можете получить в @BotFather","Чтобы получить идентификатор чата или канала, который вы выбрали для резервного копирования, вам нужно переслать сообщение от из канала на бота @userinfobot","На следующем шаге вам будет предложено ввести подпись, которую вы можете оставить пустой.","Затем вам будет предложено настроить cron-задачу, чтобы определить, когда робот будет создавать резервную копию и отправлять ее. Формат следующий: 0 1 Первое значение, равное 0, - это минута, а второе значение, равное 1, - это час. Минимальное значение для минуты - 0, максимальное - 60. Минимальное значение для часа - 0, максимальное - 24. Введите 0 для обоих значений, чтобы создавать резервную копию каждую минуту. В приведенном выше примере резервная копия создается каждый час. Обратите внимание, что между обоими значениями должен быть пробел.","Следующий шаг попросит вас выбрать панель, которую вы хотите создать резервную копию. Вам нужно выбрать одну из marzbn, x-ui и hiddify. Значение m соответствует marzban, Введите опцию m","Затем вам будет задан вопрос, хотите ли вы удалить ранее определенные cron-задачи или нет? Введите y, если вы хотите удалить их, в противном случае введите n."]}],[{"l":"Подключение к серверу","p":["Готово! Теперь самое время подключиться к Вашему серверу, сделав это можно использовав один из клиентов ниже."]},{"l":"iOS"},{"i":"streisand","l":"⭐ Streisand","p":["Streisand(iOS 14+)"]},{"l":"Shadowrocket","p":["Shadowrocket(iOS 11+)"]},{"l":"FoXray","p":["FoXray(iOS 16+)"]},{"l":"Android"},{"i":"v2rayng","l":"⭐ v2rayNG","p":["v2rayNG GitHub"]},{"l":"Hiddify-next"},{"l":"NekoBox"},{"i":"windows","l":"Windows:"},{"i":"hiddify-next","l":"⭐ Hiddify-next","p":["Hiddify-Next SETUP PORTABLE"]},{"l":"NekoRay"},{"l":"v2rayN"},{"i":"macos","l":"macOS:"},{"i":"hiddify-next","l":"⭐ Hiddify-next","p":["Hiddify-Next"]},{"i":"foxray-1","l":"FoXray"},{"l":"V2Box"}],[{"l":"Варианты подключений","p":["В данном примере мы рассмотрим все варианты inbound доступные в xray-core","В текущих реалиях, рекомендуется использовать только вариант VLESS TCP REALITY с включенным потоком","Рекомендуется изменить и настроить указанные в примерах порты, SNI и другие данные под себя","для Reality необходимо сгенерировать закрытый и открытый ключ","docker exec marzban-marzban-1 xray x25519","получение ShortID для Reality","openssl rand -hex 8"]},{"l":"VLESS"},{"l":"VLESS TCP REALITY"},{"l":"VLESS GRPC REALITY"},{"l":"VLESS H2 REALITY"},{"l":"VLESS TCP Tls"},{"l":"VLESS TCP NO TLS"},{"l":"VLESS TCP Header"},{"l":"VLESS WS Tls"},{"l":"VLESS WS"},{"l":"VLESS WS Header"},{"l":"VLESS GRPC"},{"l":"VMESS"},{"l":"VMESS TCP TLS"},{"l":"VMESS TCP"},{"l":"VMess TCP Header"},{"l":"Vmess WS TLS"},{"l":"Vmess WS"},{"l":"Vmess WS Header"},{"l":"VMESS GRPC"},{"l":"TROJAN"},{"l":"TROJAN TCP TLS"},{"l":"TROJAN WS TLS"},{"l":"TROJAN GRPC TLS"},{"l":"SHADOWSOCKS"},{"l":"WIREGUARD"}],[{"l":"Переменные окружения","p":["Вы можете установить значения для всех этих переменных в файле .env.","Если вы установили Marzban с помощью быстрого установщика, вы можете найти файл .env по пути /opt/marzban/.env"]},{"l":"UVICORN_HOST","p":["Привязка приложения к хосту (по умолчанию: 0.0.0.0)","0.0.0.0 означает все доступные адреса на машине."]},{"l":"UVICORN_PORT","p":["Привязка приложения к порту (по умолчанию: 8000)"]},{"i":"uvicorn_uds","l":"UVICORN_UDS:","p":["Привязка приложения к UNIX domain socket","Если значение установлено, переменные UVICORN_HOST и UVICORN_PORT игнорируются."]},{"i":"uvicorn_ssl_certfile","l":"UVICORN_SSL_CERTFILE:","p":["Адрес файла сертификата SSL.","Пример: /var/lib/marzban/certs/fullchain.pem"]},{"i":"uvicorn_ssl_keyfile","l":"UVICORN_SSL_KEYFILE:","p":["Адрес файла ключа SSL.","Пример: /var/lib/marzban/cert/key.pem"]},{"i":"xray_json","l":"XRAY_JSON:","p":["Адрес файла JSON конфигурации Xray. (по умолчанию: xray_config.json)"]},{"i":"xray_subscription_url_prefix","l":"XRAY_SUBSCRIPTION_URL_PREFIX:","p":["Префикс адреса подписки.","Если эта переменная не задана, ссылки на подписки в Telegram-боте не будут отправляться правильно."]},{"l":"XRAY_SUBSCRIPTION_PATH","p":["значение по умолчанию: sub","Путь к странице полписки","Пример: \"SomeRandomSUB\""]},{"i":"xray_executable_path","l":"XRAY_EXECUTABLE_PATH:","p":["Адрес исполняемого файла Xray.","Значение по умолчанию: /usr/local/bin/xray"]},{"i":"xray_assets_path","l":"XRAY_ASSETS_PATH:","p":["Путь к папке с файлами ресурсов для Xray (файлы geoip.dat и geosite.dat)","Значение по умолчанию: /usr/local/share/xray"]},{"i":"xray_exclude_inbound_tags","l":"XRAY_EXCLUDE_INBOUND_TAGS:","p":["Теги входящих соединений, которые не требуют управления и не должны быть включены в список прокси.","Пример: \" IBOUND_X INBOUND_Y INBOUND_Z\""]},{"i":"xray_fallbacks_inbound_tag","l":"XRAY_FALLBACKS_INBOUND_TAG:","p":["Если вы используете входящее соединение с несколькими резервными вариантами, укажите здесь его тег."]},{"i":"telegram_api_token","l":"TELEGRAM_API_TOKEN:","p":["Токен Telegram-бота (полученный от @botfather)"]},{"i":"telegram_admin_id","l":"TELEGRAM_ADMIN_ID:","p":["Числовой идентификатор администратора в Telegram (полученный от @userinfobot)"]},{"i":"telegram_proxy_url","l":"TELEGRAM_PROXY_URL:","p":["URL прокси для запуска Telegram-бота (если серверы Telegram заблокированы на вашем сервере).","Пример: \" socks5://127.0.0.1:1080\""]},{"i":"custom_templates_directory","l":"CUSTOM_TEMPLATES_DIRECTORY:","p":["Путь к папке с пользовательскими шаблонами.","Значение по умолчанию: app/templates"]},{"i":"clash_subscription_template","l":"CLASH_SUBSCRIPTION_TEMPLATE:","p":["Шаблон для создания конфигурации Clash.","Значение по умолчанию: clash/default.yml","Пример: default.yml"]},{"i":"subscription_page_template","l":"SUBSCRIPTION_PAGE_TEMPLATE:","p":["Шаблон для страницы подписки.","Значение по умолчанию: subscription/index.html"]},{"i":"home_page_template","l":"HOME_PAGE_TEMPLATE:","p":["Шаблон главной страницы.","Значение по умолчанию: home/index.html"]},{"i":"singbox_mux_configuration","l":"SINGBOX_MUX_CONFIGURATION:","p":["Настройки MUX для Sing-box","Значение по умолчанию: singbox/mux_config.json"]},{"l":"SUB_PROFILE_TITLE","p":["Заголовок подписки на клиенте","Пример: Susbcription"]},{"l":"SUB_SUPPORT_URL","p":["Ссылка-поддержки в подписке на клиенте","Пример: https://t.me/support"]},{"l":"SUB_UPDATE_INTERVAL","p":["Период авто-обновления подписки на клиенте","Пример: 1","установит период авто-обновления в 1 час"]},{"i":"sqlalchemy_database_url","l":"SQLALCHEMY_DATABASE_URL:","p":["URL базы данных для SQLAlchemy.","Значение по умолчанию: sqlite:///db.sqlite3"]},{"i":"webhook_address","l":"WEBHOOK_ADDRESS:","p":["Значение по умолчанию: DEFAULT","Вы можете задать несколько адресов через ,"]},{"i":"webhook_secret","l":"WEBHOOK_SECRET:","p":["Значение по умолчанию: DEFAULT"]},{"i":"sudo_username","l":"SUDO_USERNAME:","p":["Настоятельно рекомендуется использовать CLI-интерфейс для создания администратора и не использовать эту переменную."]},{"i":"sudo_password","l":"SUDO_PASSWORD:","p":["Настоятельно рекомендуется использовать CLI-интерфейс для создания администратора и не использовать эту переменную."]},{"i":"docs","l":"DOCS:","p":["Активация документации API по адресам /docs и /redoc.","Значение по умолчанию: false"]},{"i":"jwt_access_token_expire_minutes","l":"JWT_ACCESS_TOKEN_EXPIRE_MINUTES:","p":["Время истечения срока действия доступного токена в минутах.","Значение по умолчанию: 1440","0 означает \"без истечения срока действия\"."]},{"i":"debug","l":"DEBUG:","p":["Активация режима разработки (development).","Значение по умолчанию: false"]},{"i":"vite_base_api","l":"VITE_BASE_API:","p":["Префикс пути API для использования в панели управления (фронт-энд).","Значение по умолчанию: /api/"]}],[{"l":"WARP","p":["Используя это руководство, вы можете снять некоторые ограничения, налагаемые крупными компаниями, такими как Google, Spotify и т.п., на IP-адрес Вашего сервера и без проблем получать доступ к ним, используя мощности Cloudflare WARP","Обратите внимание, что для конфигураций Warp+ существует максимальное ограничение на подключение — 5 устройств одновременно, для решения проблемы вы можете использовать несколько конфигураций."]},{"l":"Вариант 1"},{"l":"Создание конфигурации Wireguard","p":["Для начала вам необходимо скачать нужный Asset из раздела релизов , этот файл разный в зависимости от процессора.","Перемещаем скачанный файл в /usr/bin/ и меняем его имя на wgcf","Затем создайте конфигурацию, используя эти две команды","Вы создали файл конфигурации wgcf-profile.conf"]},{"i":"использование-warp-необязательно","l":"Использование Warp+ (необязательно)","p":["Чтобы получить лицензию и использовать Warp+, вы можете получить license key через этого Telegram-бота","После его получения необходимо заменить license_key в файле wgcf-account.toml","Затем вам необходимо обновить информацию о конфигурации.","Затем вам нужно создать новый файл конфигурации."]},{"i":"активация-warp--в-marzban","l":"Активация WARP в Marzban","p":["Вам необходимо отредактировать ваш xray_config.json добавив в него новый OUTBOUND как в примере ниже, заполнив его данными из wgcf-profile.conf"]},{"l":"Настройки раздела маршрутизации","p":["Вам необходимо отредактировать ваш xray_config.json добавив в него новый RULES как в примере ниже, указав, какие сайты будут отправлять через WARP"]},{"l":"Вариант 2"},{"l":"Создание тунеля","p":["Устанавливаем WARP-cli"]},{"i":"активация-warp--в-marzban-1","l":"Активация WARP в Marzban","p":["Вам необходимо отредактировать ваш xray_config.json добавив в него новый OUTBOUND как в примере ниже"]},{"i":"настройки-раздела-маршрутизации-1","l":"Настройки раздела маршрутизации","p":["Вам необходимо отредактировать ваш xray_config.json добавив в него новый RULES как в примере ниже, указав, какие сайты будут отправлять через WARP"]}],[{"l":"Все на одном порту","p":["С помощью этого руководства Вы сможете установить все соединения с вашим сервером (панель, TLS-конфигурация и REALITY) через один порт. Целью этого, является задача сделать подключения к серверу более естественным и обойти ограничения на одном порту.","В этом руководстве мы используем инструмент HAProxy для достижения нашей цели.","В дальнейшем предполагается, что:","поддомен панели - panel.example.com","поддомен подписки - sub.example.com","поддомен, связанный с CDN - cdn.example.com","SNI в конфигурации REALITY - reality_domain.com","Не забудьте во всех примерах изменить их на свои","Итак, в этом руководстве мы сначала установим и настроим HAProxy, а затем внесем необходимые изменения в конфигурации и панель, чтобы принимать весь трафик на один порт."]},{"l":"Установка и настройка HAProxy","p":["В этом руководстве мы устанавливаем HAProxy непосредственно на сервере; если вы хотите, вы также можете установить его в контейнере Docker.","Кроме того, если в будущем вы планируете применять более сложные правила, не забудьте установить HAProxy из его основного репозитория, а не из репозиториев Linux.","Сначала выполните следующие команды для установки:","После установки файл конфигурации HAProxy будет находиться по адресу /etc/haproxy/haproxy.cfg.","Откройте этот файл с помощью редактора nano для редактирования.","Настройки HAProxy включают один или несколько фронтендов и один или несколько бэкендов. Каждый фронтенд направляет трафик к одному из бэкендов на основе определенных в нем правил. Понимание этих двух принципов в конфигурации HAProxy помогает нам настроить его более эффективно.","При внимательном рассмотрении этой конфигурации вы заметите, что с ее помощью HAProxy прослушивает порт 443 и принимает весь трафик. Затем, в зависимости от SNI (Server Name Indication) полученного трафика, он перенаправляет его на «локальный» порт сервера, что позволяет нам различать разные виды трафика.","Теперь добавьте следующую конфигурацию в конец файла, внесите необходимые изменения в соответствии с инструкциями и сохраните его.","Если у Вас панель и подписка на одном домене или на одном домене без саб-доменов, или Вы не используете CDN, Вы можете смело удалять соответсвующие правила и бэкенды","Вы можете использовать or для перечисления правил:","use_backend reality if { req.ssl_sni -i end reality_domain.com } or { req.ssl_sni -i end another_reality_domain.com }","После замены своих доменов и размещения этой конфигурации в конце указанного файла, выполните следующую команду для перезапуска HAProxy и завершения данного этапа настройки."]},{"l":"Подготовка конфигураций"},{"l":"Подготовка конфигурации REALITY","p":["docker exec marzban-marzban-1 xray x25519","fallback работает следующим образом: если входящий трафик соответствует этому инбаунду, он принимается, а если нет, он перенаправляется на другие инбаунды в соответствии с путем (path). Поэтому, после размещения этого инбаунда с fallback, мы определяем несколько других инбаундов, каждый с указанным путем (если у вас уже есть такие инбаунды, достаточно изменить значение listen на предопределенные значения (@vless-ws, @vmess-ws и @trojan-ws) и добавить их путь в инбаунд с fallback.","path = /lw -> listen: \"@vless-ws\"","path = /mw -> listen: \"@vmess-ws\"","path = /tw -> listen: \"@trojan-ws\"","для Reality генерация privateKey выполняется","Для лучшего использования этой возможности полезно понять ее концепцию и работу.","Единый порт для конфигураций решает эту проблему. Для этого вам нужно изменить настройки своих конфигураций следующим образом","Если конфигурация имеет send-proxy в конце бэкенда HAProxy , но не имеет acceptProxyProtocol: true, соединение не будет установлено.","Использование fallback увеличивает нагрузку на сервер. Вы можете установить разные поддомены для каждой из ваших конфигураций и использовать один и тот же HAProxy без необходимости перехода к однопортовым конфигурациям с TLS.","Итак, в соответствии с приведенным выше примером, вам просто нужно сделать разделы listen и path ваших конфигураций входящих соответствующими конфигурации fallback, чтобы все конфигурации выполнялись на одном порту.","Итак, инбаунд с fallback отправляет трафик на другие инбаунды в зависимости от пути каждого из входящих трафиков:","Как уже упоминалось, нашей целью является наличие всех коммуникаций, включая панель управления (ссылку на подписку), на одном порту.","Настройки, связанные с HAProxy, должны быть выполнены на всех узлах сервера, или вы можете определить отдельные входящие для некоторых узлов сервера и прослушивать их напрямую на 0.0.0.0","обратите внимание на строки 3, 4 и 13","обратите внимание что нужно заменить данные в dest, serverNames, privateKey на свои","Поскольку порт, указанный в inbound, является локальным портом, и фактически весь трафик идет на ваш сервер через порт 443, необходимо изменить порт на 443 в разделе хоста для созданных вами конфигураций, иначе порты по умолчанию устанавливаются для локальных конфигураций.","Предположим, что вы хотите иметь несколько разных инбаундов для каждого своего узла или несколько разных инбаундов с разными SNI. Если вы просто разместите эти инбаунды один под другим и установите для них одинаковые порты, возникнут проблемы соединения и фактически связь будет невозможна.","Пример таких конфигураций:","Ранее мы настроили параметры, относящиеся к панели управления, в конфигурации HAProxy, и в этом этапе достаточно сделать порт, на котором слушает панель, согласованным с HAProxy. Для этого вам просто нужно внести изменения в файл .env и установить переменные, указанные ниже, равными определенному значению (или тому, что вы ввели в HAProxy):","С этими изменениями ваши инбаунды будут слушать не на 0.0.0.0, а на 127.0.0.1, и вы сможете создавать любое количество инбаундов с разными локальными портами и разделять их в HAProxy на основе SNI.","Сначала нам понадобится fallback инбаунд. Для этого вы можете использовать следующий пример инбаунда:","Так же Вы должны настроить свои TLS конфигурации","Теперь перезапустите Marzban:","Теперь, если вы использовали этот метод для объединения ваших входящих с помощью fallback, откройте файл .env и установите следующую переменную равной вашему тегу входящего fallback:","Чтобы иметь все типы конфигураций с TLS, например для CDN, на одном порту, мы используем fallback xray-core."]}],[{"l":"Ограничение пользователей","p":["Вы можете ограничить количество подключений с одного конфига несколькими способами, и их способы функционирования полностью различаются."]},{"l":"V2IpLimit","p":["Для корректной работы вне Ирана, требуется Фикс","Ограничение пользователей Получить значение DATE_TIME_ZONE можно тут","Этот скрипт, для ограничения IP в Marzban, работает следующим образом: если количество подключенных IP-адресов для пользователя превышает установленный вами лимит, эта учетная запись будет отключена на указанный период времени, а затем снова активирована после истечения этого времени.","https://github.com/houshmand-2005/V2IpLimit"]},{"l":"luIP-marzban","p":["Этот скрипт работает иначе. Например, если ограничение IP установлено на одно подключение, и два пользователя пытаются подключиться к одной учетной записи, второй IP будет заблокирован через таблицу IP на указанный период времени, но первый IP останется подключенным. Таким образом, будет отключен только второй пользователь, а не будет отключена вся учетная запись","https://github.com/mmdzov/luIP-marzban"]},{"l":"RU_luIP-UFW","p":["Этот скрипт является прямым продолжением предыдущего, но с применением UFW и множеством других отличных изменений.","https://github.com/sm1ky/luIP-marzban/tree/main","https://github.com/sm1ky/luIP-marzban-node/tree/main"]}],[{"i":"переход-на-dev--версию","l":"Переход на DEV версию","p":["С помощью данного руководства Вы сможете перейти на версию Marzban для разработчиков","В версии для разработчиков возможны ошибки, если вы хотите избежать их - не переходите на неё."]},{"l":"Введение","p":["Панель Marzban имеет две версии:","LATEST- Версия Marzban по умолчанию, является самой стабильной версией.","Вы можете увидеть последние изменения последней версии по ссылке ниже:","https://github.com/Gozargah/Marzban/commits/master","DEV- Версия Marzban для разработчиков. является постоянно изменяющейся версией, для тестирования всех новых функций, которые попадут в стабильную LATEST версию","Вы можете увидеть последние изменения в версии для разработчиков по ссылке ниже.","https://github.com/Gozargah/Marzban/commits/dev"]},{"i":"переход-на-версию-для-разработчиков-dev","l":"Переход на версию для разработчиков (dev)","p":["Войдите на свой сервер и выполните следующие команды","Измените третью строку с marzban:latest на marzban:dev и сохраните изменения","выполните обновление"]}],[{"l":"Журналирование","p":["access: строка","debug: Информация, используемая для отладки программы. Включает в себя все содержимое info.","dnsLog: логический тип","error: Xray столкнулся с проблемой, которая не позволяет ему нормально работать и требует немедленного решения.","error: строка","info: Информация о статусе выполнения и т.д., которая не влияет на нормальное использование. Включает в себя все содержимое warning.","loglevel: строка","none: Не записывать никакое содержимое.","warning: Информация, выводимая при наличии некоторых проблем, которые не влияют на нормальную работу, но могут повлиять на пользовательский опыт. Включает в себя все содержимое error.","Xray имеет два типа логов: логи доступа и логи ошибок. Вы можете настроить метод вывода для каждого типа логов отдельно.","В зависимости от того, информация какого типа фиксируется системой, формируются разные типы записей.","Если Вы используете узлы, указанные пути должны быть созданы на них и примонтированны в файле docker-compose.yml","Если этот элемент не указан или является пустым значением, логи выводятся в stdout.","Запись оформляется в особый файл, который еще называют лог-файлом или журналом логов.","значение none отключает логи доступа.","значение none отключает логи ошибок.","Значение по умолчанию — warning.","Лог (log) - это хронологическая запись наиболее значимой информации о работе системы.","Определяет, нужно ли включить логи запросов DNS, например: DOH//doh.server got answer: gayporn.ru - [ip1, ip2] 2.333ms.","Подобная фиксация событий дает представление и том, что происходило в системе, в какой именно момент, какой пользователь спровоцировал то или иное событие, какие ошибки возникли и т.д.","Пример конфигурации:","Путь к файлу для логов доступа. Значение должно быть допустимым путем к файлу, например, /var/lib/marzban/access.log.","Путь к файлу для логов ошибок. Значение должно быть допустимым путем к файлу, например, /var/lib/marzban/error.log.","Уровень логирования для логов ошибок, определяющий информацию, которую необходимо записывать."]}],[{"l":"Закрываем порты панели","p":["Жизненно необходимым является сокрытие вашей панели от внешнего мира.","Сделать это вы можете с помощью UFW:","Устанавливаем UFW","Устанавливаем значения по умолчанию","Открываем порты для доступа по ssh","Открываем порты для доступа клиентов","Смотрим какие порты использованы в вашем xray_config.json и так же открываем им доступ","Например: для vless я использую порт 3030, для трояна 8443, соотвественно для меня это будет выглядеть так","Разрешаем доступ к порту, на котором работает WebUI","Если панель по дефолту на 8000","Если панель на 443","Применяем конфиг"]}],[{"l":"Закрываем порты узла","p":["Так же как и в случае с мастер-панелью, жизненно необходимым является сокрытие вашего узла от внешнего мира.","Настоятельно рекомендую закрыть порты нод, оставив доступ к ним только для доверенной мастер-панели.","Сделать это вы можете с помощью UFW:","Устанавливаем UFW","Устанавливаем значения по умолчанию","Открываем порты для доступа по ssh","Открываем порты для доступа клиентов","Смотрим какие порты использованы в вашем xray_config.json и так же открываем им доступ","Например: для vless я использую порт 3030, для трояна 8443, соотвественно для меня это будет выглядеть так","Разрешаем доступ мастер панели к портам ноды:","Где MASTER_IP- ip адрес вашей мастер панели","Применяем конфиг"]}],[{"l":"Соблюдение законодательства","p":["Статья находится в разработке","При осуществлении своей дейтельности, Вы обязаны выполнять требования и законы той страны, резидентом которой Вы являетесь, в частности, Вы обязаны ограничить посещение рессурсов запрешенных на территории РФ.","Для упрощения выполнения требований законодательства, подотовлен фильтр, который обновляется автоматически и регулярно, подгружая последние списки запрета РКН.","Актуальная версия всегда доступна по адресу","Имеет две ветки:","zapret.dat:zapret - Все что заблокировано РКН","zapret.dat:zapret-zapad - Ресурсы не обслуживающие Русских"]},{"l":"Установка для сервера","p":["Создаем папку","Скачиваем","Устанавливаем значение в .env файле","XRAY_ASSETS_PATH = /var/lib/marzban/assets/","Редактируем xray_config.json"]}],[{"l":"Установка часового пояса","p":["Для корректного отображения информации в панели, нам необходимо установить привычный для нас часовой пояс.","Устанавливаем часовой пояс, в данном примере Москва","Открываем файл docker-compose.yml","добавляем значение /etc/localtime:/etc/localtime:ro в раздел volumes","Перезагружаем контейнер"]}],[{"l":"Установка xanmod kernel","p":["Для того, что бы воспользоваться BBR3, Вам нужно перейти на ядро XanMod kernel.","Вы должны понимать что меняете ЯДРО","Все вопросы касаемо установки и использования ядра, Вы можете узнать:","https://t.me/kernel_xanmod","https://xanmod.org"]},{"l":"Авто установка","p":["Для установки Вы можете воспользоваться двумя простыми скриптами","Устанавливаем ядро","перезагрузка","Применяем изменения"]},{"l":"Ручная установка","p":["Добавляем Ключ","Добавляем репо","Устанавливаем ядро","перезагрузка","Подгружаем модули","Проверяем корректность загрузки модуля","Открываем файл","Добавляем необходимые переменные","Выполняем"]}],[{"l":"WebHook","p":["Вы можете установить webhook адрес и Marzban будет отправлять уведомления на него.","Запросы будут отправлены в виде POST запроса на адрес, указанный в WEBHOOK_ADDRESS WEBHOOK_SECRET заголовках x-webhook-secret.","Пример запроса, отправленного из Marzban:","Различные типы действий: user_created, user_updated, user_deleted, user_limited, user_expired, user_disabled, user_enabled"]}],[{"l":"API"},{"l":"Описание","p":["Marzban предоставляет REST API, который позволяет разработчикам программно взаимодействовать со службами Marzban. Чтобы просмотреть документацию по API, перейдите на API","Чтобы просмотреть документацию по API в Swagger UI или ReDoc локально, установите переменную в файле env:","Изменяем в нем следующие переменные","Перейдите в браузере http://YOUR_DOMAIN/docs или http://YOUR_DOMAIN/redoc."]}],[{"l":"Коэффициент узла","p":["Активируем Swagger для API","В открывшемся окне введите Ваш логин пароль После входа через эту страницу вам будет доступен метод GET /api/nodes/. Теперь сначала нажмите кнопку TRY, а затем выберите EXECUTE.","В этом кратком руководстве мы определим коэффициент потребления для каждого узла.","вместо node_id мы должны ввести идентификатор узла, который мы получили ранее, а в нижней части ввести параметры нашего узла вместе с желаемым коэффициентом потребления.","Внизу этой страницы перейдите в раздел NODE и нажмите на значок замка, у GET /api/nodes/.","Если мы установим для Азиатского узла коэффициент 2, и если пользователь использует эту конфигурацию, объем его учтенного и записанного в БД потребления будет удвоен.","Если мы установим для Европейского узла коэффициент 1, и если пользователь использует эту конфигурацию, объем его учтенного и записанного в БД потребления будет равен фактическому.","Если мы установим для Российского узла коэффициент 0.5 , и если пользователь использует эту конфигурацию, объем его учтенного и записанного в БД потребления будет меньше фактического.","И измените одну из строк в конце файла, как показано ниже:","И перейдите по адресу https://YOUR_DOMAIN/docs/","Нам нужен идентификатор ID узла из этого списка Дальше нам понадобится метод PUT /api/node/{node_id}. Теперь сначала нажмите кнопку TRY,","Например: Для нас стоимость трафика в разных регионах, обходится в разную стоимость. Азиатские - дороже, Европейские - дешевле, Россиийский трафик - вообще даром.","После ввода этих значений, выберите EXECUTE, и таким образом мы установим коэффициент потребления нашего узла.","После выполняем перезапуск панели","После этого будет отображен список ваших узлов включая их параметры.","Убедитесь, что эти значения точно соответствуют нужному узлу (IP, порту и т. д.).","Эта функция используется тогда, когда, например, Вы хотите добавить узел к панели, но из-за стоимости трафика этого узла, тарифицировать его, для пользователя, нужно по другому."]}],[{"l":"CLI","p":["Использование:","Options:","--help: Show this message and exit.","Commands:","admin","completion: Generate and install completion scripts.","subscription","user"]},{"l":"admin","p":["Usage:","Options:","--help: Show this message and exit.","Commands:","create: Creates an admin","delete: Deletes the specified admin","import-from-env: Imports the sudo admin from env","list: Displays a table of admins","update: Updates the specified admin"]},{"l":"admin create","p":["Creates an admin","Password can also be set using the MARZBAN_ADMIN_PASSWORD environment variable for non-interactive usages.","Usage:","Options:","-u, --username TEXT: [required]","--sudo / --no-sudo","--help: Show this message and exit."]},{"l":"admin delete","p":["Deletes the specified admin","Confirmations can be skipped using --yes/-y option.","Usage:","Options:","-u, --username TEXT: [required]","-y, --yes: Skips confirmations","--help: Show this message and exit."]},{"l":"admin import-from-env","p":["Imports the sudo admin from env","Confirmations can be skipped using --yes/-y option.","What does it do?","Creates a sudo admin according to SUDO_USERNAME and SUDO_PASSWORD.","Links any user which doesn't have an admin_id to the imported sudo admin.","Usage:","Options:","-y, --yes: Skips confirmations","--help: Show this message and exit."]},{"l":"admin list","p":["Displays a table of admins","Usage:","Options:","-o, --offset INTEGER","-l, --limit INTEGER","-u, --username TEXT: Search by username","--help: Show this message and exit."]},{"l":"admin update","p":["Updates the specified admin","NOTE: This command CAN NOT be used non-interactively.","Usage:","Options:","-u, --username TEXT: [required]","--help: Show this message and exit."]},{"l":"completion","p":["Generate and install completion scripts.","Usage:","Options:","--help: Show this message and exit.","Commands:","install: Install completion for the specified shell.","show: Show completion for the specified shell,..."]},{"l":"completion install","p":["Install completion for the specified shell.","Usage:","Arguments:","[SHELL]:[bash|zsh|fish|powershell|pwsh]: The shell to install completion for.","Options:","--help: Show this message and exit."]},{"l":"completion show","p":["Show completion for the specified shell, to copy or customize it.","Usage:","Arguments:","[SHELL]:[bash|zsh|fish|powershell|pwsh]: The shell to install completion for.","Options:","--help: Show this message and exit."]},{"l":"subscription","p":["Usage:","Options:","--help: Show this message and exit.","Commands:","get-config: Generates a subscription config.","get-link: Prints the given user's subscription link."]},{"l":"subscription get-config","p":["Generates a subscription config.","Generates a subscription config for the given user in the given format.","The output will be written in the output file when the output-file is present, otherwise will be shown in the terminal.","Usage:","Options:","-u, --username TEXT: [required]","-f, --format [v2ray|clash]: [required]","-o, --output TEXT: Writes the generated config in the file if provided","--base64: Encodes output in base64 format if present","--help: Show this message and exit."]},{"l":"subscription get-link","p":["Prints the given user's subscription link.","NOTE: This command needs XRAY_SUBSCRIPTION_URL_PREFIX environment variable to be set in order to work correctly.","Usage:","Options:","-u, --username TEXT: [required]","--help: Show this message and exit."]},{"l":"user","p":["Usage:","Options:","--help: Show this message and exit.","Commands:","list: Displays a table of users","set-owner: Transfers user's ownership"]},{"l":"user list","p":["Displays a table of users","NOTE: Sorting is not currently available.","Usage:","Options:","-o, --offset INTEGER","-l, --limit INTEGER","-u, --username TEXT: Search by username","--status [active|disabled|limited|expired]","--admin, --owner TEXT: Search by owner admin's username","--help: Show this message and exit."]},{"l":"user set-owner","p":["Transfers user's ownership","NOTE: This command needs additional confirmation for users who already have an owner.","Usage:","Options:","-u, --username TEXT","--admin, --owner TEXT: Admin's username","-y, --yes: Skips confirmations","--help: Show this message and exit."]}],[{"l":"403 ошибка","p":["При получении ошибки 403 на различных сайтах, Вы можете настройтить роутинг на ipv4","Открываем xray_config.conf"]},{"l":"Часть OUTBOUND","p":["С версии ядра 1.8.6 рекомендуется использовать значение ForceIPv4 вместо UseIPv4 Разница между “UseIPv4”, “UseIPv6” и “ForceIPv4”, “ForceIPv6” заключается в том, что первые при неудачной попытке разрешения переходят на AsIs, в то время как вторые при неудаче блокируются. Это делает всю стратегию domainStrategy более гибкой."]},{"l":"Часть RULES"}],[{"l":"URL Scheme","p":["На данный момент некоторые приложения поддерживают URL SCHEME для быстрого добавления ссылки-подписки."]},{"l":"iOS"},{"l":"Streisand"},{"l":"FoxRay"},{"l":"v2box"},{"l":"SingBox"},{"l":"ShadowRocket"},{"l":"Android"},{"l":"NekoRay"},{"l":"V2rayNG"},{"l":"PC"},{"l":"ClashX"},{"l":"Clash"},{"l":"Hiddify"}],[{"l":"Меняем ядро xray","p":["С помощью следующих инструкций вы можете изменить ядро вашего Xray-core в Marzban или Marzban Node."]},{"l":"Смена ядра на сервере панели","p":["Во всех приведенных ниже примерах файлы docker-compose.yml и .env можно найти по пути /opt/marzban, а файл xray_config.json- по пути /var/lib/marzban","Загрузка Xray-core","Для продолжения вам понадобятся пакеты unzip и wget.","Чтобы установить их, используйте следующую команду.","Сначала скопируйте ссылку на загрузку нужной версии Xray-core с страницы загрузок Xray-core и загрузите ее на сервер в папку /var/lib/marzban/xray-core.","Например, для загрузки версии 1.8.7 выполните следующие шаги:","Создайте папку для Xray и перейдите в нее.","Скачайте файл Xray с помощью wget.","Извлеките файл из архива и удалите сам архив.","Изменение ядра Marzban","Установите значение переменной XRAY_EXECUTABLE_PATH в файле .env","XRAY_EXECUTABLE_PATH = /var/lib/marzban/xray-core/xray","Перезапустите Marzban."]},{"l":"Смена ядра на сервере узла","p":["В Marzban Node также необходимо установить значение XRAY_EXECUTABLE_PATH и добавить папку /var/lib/marzban в службу, как показано ниже.","Затем перезапустите службу."]}],[{"l":"Переход на MySQL","p":["Если у Вас есть потребность в использовании базы данных MySQL, а не SQLite, Вы можете сделать следующим образом"]},{"l":"Подключение к внешней БД","p":["Откройте файл окружения","Прокомментируйте строку ниже #SQLALCHEMY_DATABASE_URL=sqlite:////var/lib/marzban/db.sqlite3","Поместите следующую строку в env заполнив ее, своими данными","Обратите внимание, что для обьявления значения строки мы должны использовать символ ', а не т.к. может быть проблема при использовании спец символов в пароле","SQLALCHEMY_DATABASE_URL = 'mysql+pymysql://username: password@host:port/database'","Здесь:","Пример:","SQLALCHEMY_DATABASE_URL = 'mysql+pymysql://myuser: mypassword@228.228.228.228:3306/mydatabase'","Не забудьте заменить myuser, mypassword, 228.228.228.228, 3306 и mydatabase на реальные данные вашей базы","Перезапустите контейнер"]},{"l":"Подключение к локальной БД","p":["MYSQL_ROOT_PASSWORD = DB_PASSWORD","SQLALCHEMY_DATABASE_URL = mysql+pymysql://root:DB_PASSWORD@127.0.0.1/marzban","Адрес панели phpmyadmin (управление базой данных): http://ваш домен:8010","Будьте внимательны, чтобы адрес страницы не содержал https.","Введите свой пароль, чтобы начать процесс изменения базы данных","Замените содержимое файла на","Изменение содержимого файла docker-compose.yml:","Обновление Linux:","Обновление Marzban","Остановите и запустите Marzban и подождите 1 минуту (не обращайте внимания на ошибки)","Откройте файл окружения","Перезагрузка Marzban","Переносим данные из sqlite в mysql:","Подключение к базе данных mysql и удаление соединения с помощью sqlite:","Подождите 1 минуту, пока старая база данных не будет перенесена (Если вы видите ошибку, игнорируйте ее)","Поместите следующий код в env и введите желаемый пароль вместо слова DB_PASSWORD(повторяется дважды).","После окончания работы перезапустите Marzban","Представляем путь дампа к mysql:","Прокомментируйте строку ниже #SQLALCHEMY_DATABASE_URL=sqlite:////var/lib/marzban/db.sqlite3","Создание дампа из старой базы:"]}],[{"l":"Пользовательский шаблон","p":["«data_limit»- ограничения по размеру трафика (в байтах). Например, 10 Гигабайт = 10737418240 Байт. Значение «0» не ставит ограничения. Если строчку убрать совсем, то ограничений также не будет.","«expire_duration»- срок подписки пользователя (в секундах). Например, 30 дней = 2592000 секундам. Значение «0» не ставит ограничения. Если строчку убрать совсем, то ограничений также не будет.","«inbounds»- теги inbounds, которые мы хотим добавить к пользовательскому шаблону. В данном случае, пользователь будет создаваться с VLESS TCP REALITY.","«name»- имя шаблона пользователя. В дальнейшем, оно будет отображаться в Telegram боте.","«username_prefix» и «username_suffix»- это префикс и суффикс, которые, соответственно, будут добавляться к имени пользователя в начале и в конце. Например: «prefix_username_suffix», где «username»— имя пользователя, «prefix_»— префикс и «_suffix»– суффикс, соответственно. Префикс и суффикс также не являются обящательными полями при создании шаблона пользователя и строки с ними можн оне добавлять, если в этом нет необходимости.","Ваш ID профиля можно узнать у бота @getmyid_bot","Вводим данные от своего бота, созданного в @BotFather","Вводим имя пользователя или генерируем рандомное:","Вводим конфигурацию для пользовательского шаблона:","Выбираем созданный ранее шаблон пользователя:","где:","Готово! Пользователь по шаблону создан. Теперь он должен отобразиться как в боте, так и в самой панели Marzban:","Далее, в браузере переходим по адресу https:/YOUR_DOMAIN.COM/docs","Далее, нам необходим рабочий Telegram бот Marzban. Если он уже установлен, можно переходить к следующего шагу.","Для начала, заходим на сервер, где установлен Marzban и открываем конфигурационный файл:","Для установки Telegram бота:","Идем в раздел « user_templates» И выбираем « Add User Template». Внутри открытого спойлера нажимаем « Try it out»","Как только закончили править шаблон, нажимаем на « Execute» и шаблон сохраняется в базу данных и его можно использовать в Telegram боте:","Нажимаем на кнопку авторизации и вводим свои данные администратора:","Например:","Открываем конфигурационный файл Marzban:","Перезагружаем marzban:","Переходим в бота и нажимаем « Create User From Template»:","После отправки имени пользователя, проверяем данные и нажимаем « Done»:","С помощью этого руководства вы можете создать пользовательские шаблоны для Telegram бота и на основе шаблонов создавать или редактировать пользователей Marzban.","Убираем комментарий # со строчки DOCS=TRUE, сохраняем файл:"]}],[{"l":"Убираем рекламу с AdGuard","p":["AdGuard DNS — это приложение для блокировки рекламы и интернет-трекеров на уровне сети Linux, которое действует как приемник DNS и, при необходимости, DHCP-сервер, предназначенный для использования в частной сети.","Adguard Home будет доступен по следующим адресам","http://127.0.0.1:3000","http://X.X.X.X:3000","nameserver 127.0.0.1","Активируем шифрование и активируем ранее полученные сертификаты","Готово! Теперь вы можете настроить сам AdGuard DNS","Для блокировки рекламы на стороне сервера, предлагается использовать программное решение AdGuard DNS","Для начала нам нужно обновить сервер","добавив туда","Измените DNS-сервер","Измените DNS-сервер в файле конфигурации вашего xray-config.json","или сделав тоже самое через WebUI","настраиваем фильтры и ДНС","Перезагрузить marzban","Скачайте и распакуйте AdGuard DNS","Устанавливаем"]}],[{"l":"Убираем рекламу с Pi-Hole","p":["IP-ADDRESS/admin","nameserver 127.0.0.1","Pi-hole — это приложение для блокировки рекламы и интернет-трекеров на уровне сети Linux, которое действует как приемник DNS и, при необходимости, DHCP-сервер, предназначенный для использования в частной сети.","Setting - DNS","Tools - Update Gravity -Update","Адрес входа в панель управления pi-hole","В конце установки вы получите адрес и пароль (вы можете изменить пароль)","Готово! Теперь вы можете настроить сам Pi-Hole","Для блокировки рекламы на стороне сервера, предлагается использовать программное решение Pi-Hole","Для начала нам нужно обновить сервер","добавив туда","Запустите pi-hole","Измените DNS-сервер","Измените DNS-сервер в файле конфигурации вашего xray-config.json","Измените пароль","или сделав тоже самое через WebUI","Обновите и затем перейдите к","Перезагрузить marzban","Перейдите в настройки Pi-Hole","При достижения этапа STATIC IP, нам необходимо выбрать вариант \"Продолжить\" слева Продолжайте вводить \"Yes\" до завершения установки","Примените изменения и сохраните внизу страницы","Установите pi-hole"]}],[{"l":"Маршрутизация","p":["Модуль функций маршрутизации может отправлять входящие данные по различным правилам через разные исходящие соединения. Обычное использование включает в себя разделение трафика внутри и за пределами страны. Xray может определять трафик различных регионов с помощью внутренних механизмов и отправлять их через разные исходящие прокси."]},{"i":"объект-маршрутизации-routingobject","l":"Объект маршрутизации (RoutingObject)","p":["RoutingObject соответствует элементу routing в конфигурационном файле.","domainStrategy: \"AsIs\" | \"IPIfNonMatch\" | \"IPOnDemand\" Стратегия разрешения доменов. В зависимости от установки используются различные стратегии.","\"AsIs\": Использовать только доменное имя для выбора маршрута. Значение по умолчанию.","\"IPIfNonMatch\": Если доменное имя не соответствует ни одному правилу, разрешить домен в IP (записи A или AAAA) и повторно сопоставить;","Если у домена есть несколько записей A, попробуйте сопоставить все записи A, пока одна из них не совпадет с каким-либо правилом;","Разрешенный IP действует только при выборе маршрута, в перенаправляемых пакетах данных по-прежнему используется оригинальное доменное имя;","\"IPOnDemand\": Если при сопоставлении встречается любое правило, основанное на IP, немедленно разрешить доменное имя в IP для сопоставления;","domainMatcher: \"hybrid\" | \"linear\" Алгоритм сопоставления доменов. В зависимости от установки используются различные алгоритмы. Этот параметр влияет на все объекты RuleObject, которые не указывают собственный алгоритм сопоставления.","\"hybrid\": Использовать новый алгоритм сопоставления доменов, который быстрее и требует меньше ресурсов. Значение по умолчанию.","\"linear\": Использовать первоначальный алгоритм сопоставления доменов.","rules: [RuleObject] Соответствует массиву, каждый элемент которого является правилом. Для каждого соединения маршрутизация будет судить по этим правилам сверху вниз, и когда оно встретит первое действующее правило, то направит это соединение к указанному outboundTag или balancerTag.","balancers: [BalancerObject ]","Массив, каждый элемент которого является конфигурацией балансировщика нагрузки. Когда правило указывает на балансировщик, Xray выбирает один outbound через этот балансировщик для перенаправления трафика."]},{"i":"объект-правил-ruleobject","l":"Объект правил (RuleObject)","p":["\"a-b\": a и b - положительные целые числа, меньше 65536. Диапазон включает оба конца, правило активируется, если порт источника находится в этом диапазоне.","\"a-b\": a и b - положительные целые числа, меньше 65536. Диапазон включает оба конца, правило активируется, если целевой порт находится в этом диапазоне.","\"hybrid\": Использовать новый алгоритм сопоставления доменов, который быстрее и требует меньше ресурсов. Значение по умолчанию.","\"linear\": Использовать первоначальный алгоритм сопоставления доменов.","a: a - положительное целое число, меньше 65536. Правило активируется, если порт источника равен a.","a: a - положительное целое число, меньше 65536. Правило активируется, если целевой порт равен a.","attrs: object JSON-объект, ключи и значения которого являются строками, используемыми для определения атрибутов трафика. Если заголовки HTTP содержат все указанные ключи и значения содержат указанные подстроки, то правило считается совпавшим. Регистр ключей не учитывается. Значения могут быть представлены в виде регулярных выражений. На данный момент только HTTP-входящий прокси устанавливает этот атрибут. Примеры:","balancerTag: string Соответствует тегу балансировщика.","CIDR: Например, \"10.0.0.0/8\".","domain: [string] Массив, каждый элемент которого соответствует сопоставлению домена. Возможные формы:","domainMatcher: \"hybrid\" | \"linear\" Алгоритм сопоставления доменов. Этот параметр имеет приоритет над настройкой domainMatcher в RoutingObject.","inboundTag: [string] Массив, каждый элемент которого является идентификатором. Правило активируется, если один из элементов совпадает с тегом входящего протокола.","ip: [string] Массив, каждый элемент которого представляет собой диапазон IP. Если один из элементов соответствует целевому IP, правило активируется. Возможные формы:","IP: Например, \"127.0.0.1\".","network: \"tcp\" | \"udp\" | \"tcp,udp\" Возможные значения: \"tcp\", \"udp\", \"tcp,udp\". Правило активируется, если тип соединения совпадает с указанным.","outboundTag: string Соответствует тегу исходящего соединения.","port: number | string Диапазон целевых портов, возможные формы:","protocol: [\"http\" | \"tls\" | \"bittorrent\" ] Массив, каждый элемент которого обозначает тип протокола. Правило активируется, если тип протокола соединения совпадает с одним из указанных.","source: [string] Массив, каждый элемент которого представляет собой диапазон IP для источника. Форматы включают IP, CIDR, GeoIP и загрузку IP из файла. Правило активируется, если один из элементов соответствует IP источника.","sourcePort: number | string Порт источника, возможные формы:","type: \"field\" В настоящее время поддерживается только опция \"field\".","user: [string] Массив, каждый элемент которого - это электронный адрес. Правило активируется, если один из элементов совпадает с пользователем-источником.","Для обнаружения Content Type: {accept: text/html}","Для обнаружения HTTP GET: {:method: GET}","Для обнаружения HTTP Path: {:path: /test}","Загрузка IP из файла: Формат \"ext:file:tag\", должен начинаться с \"ext:\" (в нижнем регистре), за которым следует имя файла и тег. Файл должен находиться в Ресурсной директории, его формат должен быть аналогичен geoip.dat, тег должен присутствовать в файле.","Загрузка доменов из файла: Формат \"ext:file:tag\", должен начинаться с \"ext:\" (в нижнем регистре), за которым следует имя файла и тег. Файл должен находиться в Ресурсной директории, его формат должен быть аналогичен geosite.dat, тег должен присутствовать в файле.","Комбинация обоих форм, разделенная запятыми, например: \"53,443,1000-2000\".","Поддомен (рекомендуется): Начинается с \"domain:\", остальная часть - домен. Если этот домен является целевым доменом или его поддоменом, правило активируется. Например, \"domain:xray.com\" совпадает с \"www.xray.com\", \"xray.com\", но не с \"wxray.com\".","Полное соответствие: Начинается с \"full:\", остальная часть - домен. Если этот домен полностью совпадает с целевым доменом, правило активируется. Например, \"full:xray.com\" совпадает с \"xray.com\", но не с \"www.xray.com\".","Предопределенный список IP: Включен в каждую установку Xray, файл называется geoip.dat. Используется, например, как \"geoip:cn\", должен начинаться с \"geoip:\" (в нижнем регистре), за которым следует двухбуквенный код страны.","Предопределенный список доменов: Начинается с \"geosite:\", остальная часть - имя, например, geosite:google или geosite:cn. Имена и списки доменов смотрите в Предопределенных списках доменов.","Простая строка: Если эта строка соответствует любой части целевого домена, то правило активируется. Например, \"sina.com\" совпадает с \"sina.com\", \"sina.com.cn\" и \"www.sina.com\", но не с \"sina.cn\".","Регулярное выражение: Начинается с \"regexp:\", остальная часть - регулярное выражение. Если оно соответствует целевому домену, правило активируется. Например, \"regexp:\\.goo.*\\.com$\" совпадает с \"www.google.com\" или \"fonts.googleapis.com\", но не с \"google.com\".","Специальное значение: \"geoip:private\" включает все частные адреса, такие как 127.0.0.1.","Функция исключения (!): \"geoip:!cn\" означает результаты, не включенные в \"geoip:cn\"."]},{"i":"объект-балансировщика-balancerobject","l":"Объект балансировщика (BalancerObject)","p":["Конфигурация балансировщика. Когда балансировщик активен, он выбирает один из наиболее подходящих исходящих соединений для перенаправления трафика.","tag: string Идентификатор балансировщика, используемый для соответствия тегу балансировщика в RuleObject.","selector: [string ] Массив строк, каждая из которых используется для сопоставления с префиксом тега исходящего соединения. Например, если есть исходящие соединения с тегами [\"a\", \"ab\", \"c\", \"ba\"], то selector: [a] будет соответствовать [\"a\", \"ab\"]. Если найдено несколько исходящих соединений, балансировщик выбирает одно из них случайным образом.","strategy: object Стратегия выбора исходящего соединения. type: roundRobin означает последовательный выбор среди подходящих тегов исходящих соединений. Если поле strategy не указано, выбор осуществляется случайно.","Пример конфигурации:"]},{"l":"Предопределенные списки доменов","p":["apple: Включает большинство доменов Apple.","category-ads-all: Включает в себя распространенные рекламные домены и домены рекламных провайдеров.","category-ads: Содержит распространенные рекламные домены.","cn: Эквивалентно сочетанию geolocation-cn и tld-cn.","facebook: Включает большинство доменов Facebook.","geolocation-!cn: Включает распространенные домены за пределами континентального Китая и tld-!cn.","geolocation-cn: Включает распространенные домены континентального Китая.","google: Включает большинство доменов Google.","microsoft: Включает большинство доменов Microsoft.","telegram: Включает большинство доменов Telegram.","tld-!cn: Включает домены, не используемые в континентальном Китае, например, домены, заканчивающиеся на .hk (Гонконг), .tw (Тайвань), .jp (Япония), .sg (Сингапур), .us (США), .ca (Канада) и т.д.","tld-cn: Включает домены, управляемые CNNIC, используемые в континентальном Китае, например, домены, заканчивающиеся на .cn, .中国.","twitter: Включает большинство доменов Twitter.","Полный список доменов можно найти в сообществе списков доменов [Domain list community].","Часто используемые категории доменов включают:","Эти списки включены в каждую установку Xray, файл называется geosite.dat. Файл содержит наборы часто используемых доменов, которые можно использовать для маршрутизации или фильтрации DNS с помощью синтаксиса geosite:filename. Например, geosite:google представляет домены Google, включенные в файл."]}],[{"l":"Встроенный DNS-сервер","p":["Встроенный модуль DNS в Xray, в основном, используется для двух целей:","На этапе маршрутизации: Разрешает доменные имена в IP-адреса, и на основе полученных IP-адресов производит соответствие правилам для разделения трафика. Разрешение доменных имен и разделение трафика зависят от значения domainStrategy в модуле настройки маршрутизации. Встроенный DNS-сервер используется для DNS-запросов только при установке следующих значений:","IPIfNonMatch: При запросе домена сначала производится попытка соответствия домену в маршрутизации. Если соответствие не найдено, то для этого домена используется встроенный DNS-сервер для DNS-запроса, и полученный IP-адрес снова используется для соответствия IP-маршрутизации.","IPOnDemand: При соответствии на основе любых правил, основанных на IP, доменное имя немедленно разрешается в IP для соответствия.","Для разрешения целевых адресов при подключении:","Например, в настройках исходящего соединения freedom, если domainStrategy установлен в UseIP, запросы, исходящие от этого соединения, сначала разрешают доменное имя через встроенный сервер в IP, а затем подключаются.","Также, в настройках sockopt, если domainStrategy установлен в UseIP, системные соединения, инициированные этим выходом, сначала разрешаются через встроенный сервер в IP, а затем подключаются.","DNS-запросы, отправляемые встроенным DNS-сервером, автоматически перенаправляются в соответствии с настройками маршрутизации.","Поддерживаются только базовые IP-запросы (записи A и AAAA), записи CNAME будут повторно запрашиваться до возврата записей A/AAAA. Другие запросы не будут обрабатываться встроенным DNS-сервером."]},{"l":"Процесс обработки DNS","p":["Если текущее запрашиваемое доменное имя:","Соответствует маппингу 'домен - IP' или 'домен - массив IP' в hosts, то этот IP или массив IP возвращается в качестве результата DNS-разрешения.","Соответствует маппингу 'домен - домен' в hosts, то значение этого маппинга (другое доменное имя) становится текущим запрашиваемым доменным именем и входит в процесс обработки DNS, пока не будет разрешено в IP или возвращено пустое разрешение.","Не соответствует hosts, но соответствует списку доменов в одном (или нескольких) DNS-серверах в domains, то в соответствии с приоритетом правил, последовательно используются DNS-серверы, соответствующие этому правилу, для запроса. Если запрос на сервере DNS, соответствующем правилу, не удался или expectIPs не соответствует, используется следующий соответствующий сервер DNS; в противном случае возвращается разрешенный IP. Если все соответствующие серверы DNS не удались или expectIPs не соответствует, тогда компонент DNS:","По умолчанию проводит 'DNS-запрос с откатом (fallback)': использует серверы DNS, которые «не были использованы в предыдущем неудачном запросе и для которых skipFallback имеет значение false по умолчанию», для последовательного запроса. Если запрос не удался или expectIPs не соответствует, возвращается пустое разрешение; в противном случае возвращается разрешенный IP.","Если disableFallback установлен в true, то 'DNS-запрос с откатом (fallback)' не проводится.","Не соответствует ни hosts, ни списку доменов в DNS-серверах domains, то:","** По умолчанию используются 'DNS-серверы с skipFallback по умолчанию false'** для последовательного запроса. Если первый выбранный DNS-сервер не удался или expectIPs не соответствует, используется следующий выбранный DNS-сервер; в противном случае возвращается разрешенный IP. Если все выбранные DNS-серверы не удалось или expectIPs` не соответствует, возвращается пустое разрешение.","Если количество 'DNS-серверов с skipFallback по умолчанию false' равно 0 или disableFallbackустановлен вtrue', то используется первый DNS-сервер в конфигурации DNS. Если запрос не удался или expectIPs не соответствует, возвращается пустое разрешение; в противном случае возвращается разрешенный IP."]},{"l":"DnsObject","p":["{\"address\": \"1.1.1.1\",\"port\": 53,\"domains\": [\"domain:xray.com\"],\"expectIPs\": [\"geoip:us\"],\"skipFallback\": true,\"clientIP\": \"2.2.2.2\"}","• IP-адрес клиента, используемый при DNS-запросах для информирования сервера о местоположении клиента. Это не должен быть частный IP-адрес.","clientIP: string","DnsObject соответствует пункту dns в файле конфигурации.","domains: [string]","expectIPs: [string]","hosts: map| map{string: [address]}","IP-адрес клиента, используемый для запросов DNS. Этот параметр не должен быть частным адресом.clientIP: string","port: number","ServerObject является более сложной конфигурацией для DNS-сервера, позволяя настроить не только адрес и порт, но и специфические домены для запросов, ожидаемые IP-адреса, а также определение поведения при fallback-запросах и указание клиентского IP.","servers: [string | ServerObject]","skipFallback: true | false","true означает, что этот сервер DNS будет пропущен при запросах DNS с откатом (fallback). По умолчанию false, то есть сервер не будет пропущен.","Адрес сервера DNS, поддерживаются два типа: DNS-адреса (в формате строки) и ServerObject.","В этом примере сервер DNS с адресом 1.1.1.1 и портом 53 будет использоваться для запросов доменов, соответствующих “domain:xray.com”. Он также будет проверять, соответствуют ли возвращаемые IP-адреса геолокации США (geoip:us). Если запрос не удастся или возвращаемые IP не соответствуют ожидаемым, запрос будет пропущен (skipFallback: true). Запрос будет отправлен, как если бы он происходил от IP-адреса 2.2.2.2.","Если адрес содержит несколько IP и доменных имен, возвращается только первый домен, остальные IP и доменные имена игнорируются.","Если адрес этого элемента является IP, то результатом разрешения является IP этого элемента.","Если адрес этого элемента является доменным именем, то будет использоваться этот домен для IP-разрешения, а не исходное доменное имя.","Если значение \"localhost\", это означает использование настроек DNS локального компьютера.","Если это DNS \"IP:Port\" адрес, например, \"8.8.8.8:53\", Xray будет использовать указанный UDP порт этого адреса для DNS-запросов. Запросы следуют правилам маршрутизации. По умолчанию используется порт 53, если он не указан.","Если это DNS \"IP\" адрес, например, \"8.8.8.8\", Xray будет использовать указанный UDP порт этого адреса для DNS-запросов. Запросы следуют правилам маршрутизации. По умолчанию используется порт 53.","Если это адрес \"tcp://host:port\", например, \"tcp://8.8.8.8:53\", Xray будет использовать DNS over TCP для запросов. Запросы следуют правилам маршрутизации. По умолчанию используется порт 53, если он не указан.","Если это адрес \"tcp://host\", например, \"tcp://8.8.8.8\", Xray будет использовать DNS over TCP для запросов. Запросы следуют правилам маршрутизации. По умолчанию используется порт 53.","Если это адрес \"tcp+local://host:port\", например, \"tcp+local://8.8.8.8:53\", Xray будет использовать локальный режим TCP (TCPL) для запросов. То есть запросы DNS не проходят через компонент маршрутизации и направляются напрямую через исходящее соединение Freedom, что сокращает время ожидания\"dns\": {\"servers\": [ \"https://1.1.1.1/dns-query\", { \"address\": \"https://8.8.8.8/dns-query\", \"domains\": [ \"geosite:netflix\" ], \"address: address","Если это адрес \"tcp+local://host\", например, \"tcp+local://8.8.8.8\", Xray будет использовать локальный режим TCP (TCPL) для запросов. То есть запросы DNS не проходят через компонент маршрутизации и направляются напрямую через исходящее соединение Freedom. По умолчанию используется порт 53.","Поддомен (рекомендуется): Начинается с \"domain:\", и остальная часть является доменным именем. Правило активируется, когда это доменное имя является целевым доменным именем или его поддоменом. Например, \"domain:xray.com\" соответствует \"www.xray.com\" и \"xray.com\", но не \"wxray.com\".","Подстрока: Начинается с \"keyword:\", и остальная часть является строкой. Правило активируется, когда эта строка соответствует любой части целевого доменного имени. Например, \"keyword:sina.com\" соответствует \"sina.com\", \"sina.com.cn\" и \"www.sina.com\", но не \"sina.cn\".","Порт сервера DNS, например 53. Если порт не указан, по умолчанию используется 53. При использовании DOH, DOHL, DOQL порт не учитывается, нестандартные порты должны быть указаны в URL.","Предопределенный список доменных имен: Начинается с \"geosite:\", и остальная часть является именем, например geosite:google или geosite:cn. Список имен и доменных имен можно найти в разделе \"Предопределенные доменные имена\".","Пример конфигурации ServerObject:","Простая строка: Правило активируется, когда эта строка полностью соответствует целевому доменному имени. Например, \"xray.com\" соответствует \"xray.com\", но не \"www.xray.com\".","Регулярное выражение: Начинается с \"regexp:\", и остальная часть является регулярным выражением. Правило активируется, когда это регулярное выражение соответствует целевому доменному имени. Например, \"regexp:\\.goo.*\\.com$\" соответствует \"www.google.com\", \"fonts.googleapis.com\", но не \"google.com\".","Список DNS-серверов, поддерживающих два типа: DNS-адреса (в формате строки) и ServerObject.","Список диапазонов IP-адресов, аналогичный тому, что используется в настройках маршрутизации. Когда задан, Xray DNS проверит IP-адреса в возвращаемом ответе и вернет только те, которые включены в список expectIPs. Если этот параметр не задан, IP-адреса возвращаются без изменений.","Список доменных имен, запросы на которые будут направлены на этот сервер DNS. Формат доменных имен аналогичен тому, что используется в настройках маршрутизации.","Статический список IP, значениями которого являются серии \"домен\": \"адрес\" или \"домен\": [\"адрес 1\", \"адрес 2\"]. Адрес может быть IP или доменным именем. При разрешении доменного имени, если оно соответствует одному из элементов этого списка:","Требуется поддержка EDNS Client Subnet со стороны DNS-сервера для использования этой функции.","Форматы доменных имен включают:","Эта конфигурация позволяет тонко настраивать поведение DNS в Xray, обеспечивая большую гибкость в управлении сетевым трафиком и решении различных сетевых задач.","Эти настройки особенно полезны в сложных сетевых сценариях, где требуется точное управление DNS-запросами и их маршрутизацией."]}],[{"l":"Блог"}],[{"l":"Про UDP","p":["Большинство людей абсолютно не имеют представления о части UDP в протоколах прокси, и в настоящее время многие опытные пользователи и даже разработчики становятся в тупик при столкновении с UDP, что приводит к тому, что большинство проблем, связанных с UDP, остаются нерешенными. Учитывая, что UDP играет всё более и более важную роль, но нет ни одной статьи о UDP в протоколах прокси, была написана эта статья. Цель этой статьи - изменить текущую ситуацию и позволить всем полностью разобраться в UDP, чтобы использовать Xray-core или другое программное обеспечение для прокси более свободно."]},{"i":"простое-понимание-ip-packet-tcp-connection-пятиэлементных-наборов-портов-user-datagram-protocol","l":"Простое понимание IP Packet, TCP Connection, пятиэлементных наборов, портов, User Datagram Protocol","p":["Это основные концепции, которые необходимо освоить, на самом деле они очень просты. IP Packet: отдельные пакеты данных, соответствующие протоколу IP, допускающие потерю пакетов, разрешающие изменение порядка (то есть порядок приема отличается от порядка отправки), относящиеся к ненадежной передаче. Это не самый нижний уровень, здесь не нужно углубляться, главное - знать его характеристики. Пакеты данных IP не могут напрямую обеспечить надежную передачу, что, конечно, неудобно для приложений, поэтому существует протокол TCP, ориентированный на соединение, который основан на пакетах данных IP, но реализует механизм соединения и надежной передачи, большинство других протоколов могут быть просто размещены на TCP. Определение TCP-соединения - это \"пятиэлементный набор\":","Идентификатор самого протокола TCP","Собственный IP-адрес","Используемый собственный порт (Port)","IP-адрес другой стороны","Порт, используемый другой стороной","После установления TCP-соединения обе стороны могут отправлять прикладные данные с собственных портов на порты другой стороны, это полнодуплексная передача, то есть обе стороны могут одновременно отправлять и принимать данные. Концепция \"порта\" всем знакома, она часто появляется вместе с IP, но на самом деле она не относится к протоколу IP (удивительно, не так ли? jpg), она принадлежит к более высоким протоколам TCP, UDP. TCP и UDP реализуют механизм \"порта\", поэтому порты этих двух протоколов не влияют друг на друга. Протокол, используемый ping, - ICMP, он также основан на пакетах данных IP и похож на TCP, UDP, но у ICMP нет концепции \"порта\". Кстати, обычные протоколы прокси мог ут проксировать только TCP или добавлять UDP, но не могут проксировать ICMP, поэтому ping невозможен, для этого нужно использовать традиционный VPN. Теперь настала очередь нашего главного героя выйти на сцену: UDP (User Datagram Protocol) Хотя UDP, как и TCP, основан на пакетах данных IP, он чрезвычайно прост, прямо полностью наследует характеристики пакетов данных IP:","Допускает потерю пакетов","Разрешает изменение порядка","Очевидно, относится к ненадежной передаче","Вы можете просто понимать это так: протокол UDP просто добавляет механизм портов и проверку к протоколу IP. Для UDP механизм \"соединения\" TCP также отсутствует, то есть после получения локального UDP-порта можно напрямую отправлять прикладные данные на любой UDP-порт любого IP без необходимости рукопожатия/установления соединения. Не нужно заботиться о том, получил ли другая сторона данные, другая сторона тоже не скажет вам, получила ли она данные. (Стоит отметить: существует промежуточное состояние connected UDP, это просто определение адреса назначения перед отправкой данных, без реального рукопожатия) Эти характеристики UDP породили три способа применения:","Сосредоточение на эффективности, например, запросы DNS (не требуется предварительное рукопожатие)","Сосредоточение на реальном времени, например, прямые трансляции, голосовые данные (допускается потеря пакетов, не требуется ожидание переотправки)","Оба эти аспекта + P2P, например, некоторые онлайн-игры, голосовые данные. Обратите внимание, что это полное использование вышеупомянутой особенности UDP, что также является ключевой точкой этой статьи.","Конечно, существует ещё один способ использования UDP: создание новых универсальных надежных транспортных протоколов на его основе, таких как KCP, QUIC. Почему эти новые протоколы не основаны напрямую на протоколе IP, а базируются на UDP? Потому что первое часто требует от операторов на всех уровнях изменения оборудования и систем для поддержки, что, очевидно, не совсем реалистично, поэтому UDP стал более подходящим выбором."]},{"i":"так-что-же-такое-fullcone-и-symmetric","l":"Так что же такое FullCone и Symmetric?","p":["Address Restricted Cone: Внешний хост может отправлять пакеты на внутренний IP-адрес и порт только если внутренний хост уже отправлял пакеты этому внешнему хосту.","Dokodemo-door TPROXY на входе (прозрачный прокси)","Freedom на выходе, поддержка разрешения доменных имен","Full Cone: Любой внешний хост может отправлять пакеты на внутренний IP-адрес и порт, если внутренний хост уже отправил пакеты наружу.","HTTP на входе и выходе не поддерживает проксирование UDP, Socks до версии 5 также не поддерживает UDP.","Port Restricted Cone: Похоже на Address Restricted Cone, но внешний хост должен отправлять пакеты на тот же порт, с которого внутренний хост отправлял пакеты на внешний хост.","RFC 3489 определяет четыре классических типа поведения NAT, и v2ray на самом деле не подпадает ни под один из них напрямую, но его поведение наиболее близко к Address and Port-Dependent Mapping с Endpoint-Independent Filtering, что соответствует NAT Type 7 по RFC 5780. Однако v2ray может неправильно обрабатывать источник возвращаемых пакетов.","Shadowsocks на входе и выходе","Socks на входе и выходе","Socks5 и Shadowsocks используют нативный UDP, и их UDP-трафик не идет через нижележащий транспорт.","Symmetric: Внутренний хост использует разные маппинги для каждого внешнего хоста и порта, с которыми он общается, и только пакеты, отправленные на адрес","Trojan на входе и выходе","UDP over TCP, сокращенно UoT, важно заметить, что даже если используются mKCP или QUIC в качестве нижележащего транспорта, UoT не будет демонстрировать те же характеристики, что и нативный UDP.","VLESS (FullCone в разработке)","VLESS, Trojan, VMess, Mux используют UDP over TCP и идут через нижележащий транспорт.","VMess, поскольку структура протокола не поддерживает FullCone","Архитектурно v2ray-core поддерживает только Symmetric NAT, поэтому любой протокол, используемый в v2ray-core, будет работать только в режиме Symmetric.","В v2ray-core время неактивности для поддержания отношений маппинга UDP очень короткое, что легко приводит к обрывам потока данных.","В заметках к релизу Xray-core содержится много полезной информации:","В конце июля прошлого года я обсуждал эту проблему в группе разработчиков (нестандартные тестовые серверы, такие как серверы Google, и запутанное поведение UDP в v2ray), после чего обновление NatTypeTester оставило только пять стандартных тестовых серверов и специально проверило исходящие адреса пакетов, что привело к отображению результатов для v2ray как UnsupportedServer.","В нормальной ситуации Symmetric NAT, если A отправил пакеты M, он может получать пакеты только от M, а остальные будут отфильтрованы.","Главное, что адрес N при этом теряется, и A будет думать, что пакеты от M, что является уникальным источником путаницы.","Для реализации FullCone в Docker, сетевой режим связанных контейнеров должен быть Host.","Для реализации FullCone в цепочке прокси, как правило, все звенья должны поддерживать FullCone.","Дополнение: Socks и SS используют нативный UDP, и их UDP-трафик не подвергается специальной обработке при использовании TLS/WSS, если только не включен Mux. UDP-плагины SIP003 для SS также не управляются.","Если из-за различия целевых двуэлементных наборов маршрутизатор отображает A->M и A->N как A1->M и A2->N соответственно (обычно используя два разных порта для отправки пакетов) и строго ограничивает источник обратных пакетов, это относится к Symmetric. Не трудно заметить, что в этом случае коммуникация становится похожей на TCP \"соединение\", что является практикой большинства провайдеров. Если маршрутизатор смотрит только на исходный двуэлементный набор A и всегда отображает его как свой A1 для отправки пакетов к M и N, это относится к Cone NAT; далее, если A1 получает обратный пакет, маршрутизатор отправляет его обратно к A, не обращая внимания на источник, это относится к FullCone, которое является лучшим уровнем NAT для программного обеспечения прокси и необходимым атрибутом для P2P игр (GTA NAT открыт) Приведенные выше примеры упрощены, и на практике провайдеры вряд ли предоставят вам публичный IP-адрес напрямую, что означает, что прохождение через несколько уровней NAT и получение Symmetric является нормой. Поч ему же использование протоколов прокси, таких как Shadowsocks или Trojan от Xray-core, позволяет получить FullCone? Это просто, потому что в этом случае используется публичный IP вашего VPS, который не связан с вашей локальной средой NAT. Вот почему важно специально настроить брандмауэр VPS: по умолчанию он будет фильтровать источник возвращаемых пакетов, что приведет к тому, что вы получите какой-то вид Restricted Cone, а не FullCone. Для простых потребностей UDP, таких как запросы DNS, Symmetric также может быть использован. Но для более сложных требований к UDP, таких как различные P2P сценарии, реализация FullCone становится крайне важной, так как приложению необходимо использовать фиксированный порт для отправки пакетов к любой цели и получения пакетов от любой цели без ограничений (по крайней мере, не ошибитесь в определении текущего типа NAT, что будет объяснено далее). Если ваша основная цель - игры, вы можете позволить UDP работать через протокол SS, поскольку он обладает нативными характеристиками UDP. Здесь стоит отметить, что Xray-core планирует внедрение протоколов, более подходящих для игр.","Если между ними вставлен v2ray, даже если A не отправлял пакеты N, A всё равно может получать пакеты от N.","Здесь FullCone относится к поведению NAT для UDP; при настройке особое внимание уделяется настройке брандмауэра.","Известно, что поддержка UDP в v2ray оставляет желать лучшего, поэтому Xray-core был перестроен с учетом связанных архитектур и кода для входящих и исходящих соединений, а также после многократных тестов и устранения множества деталей и ошибок, была достигнута полная поддержка FullCone (за исключением случаев, когда протокол не поддерживает, для которых предусмотрен адекватный Symmetric, у VMess в Clash есть проблемы).","Кроме того, некоторые приложения Google сначала тестируют тип NAT текущей сети самостоятельно, и если обнаруживается ложный FullCone, это может привести к различным странным проблемам. Действительно, поведение NAT не ограничивается только FullCone и Symmetric, хотя это два крайних случая. Фактически, поведение NAT определяется двумя аспектами: \"маппингом при отправке пакетов\" и \"фильтрацией при получении пакетов\". FullCone является самым открытым в обоих аспектах, в то время как Symmetric является самым строгим.","Локальный исходный двуэлементный набор A отправляет несколько пакетов другому удаленному целевому двуэлементному набору N","Локальный исходный двуэлементный набор A отправляет несколько пакетов удаленному целевому двуэлементному набору M","Обработка UDP в v2ray-core похожа на логику TCP, и невозможно реализовать специфическое для UDP поведение FullCone.","По поводу третьего пункта, проще говоря:","Поддержка только Symmetric реализована для:","При обработке входящих пакетов в выходном модуле Freedom v2ray-core не фильтрует источник в соответствии с принципом Symmetric, что и является основной причиной \"мистики\".","Проблемы, существующие в v2ray-core, здесь разъясняются, чтобы сделать UDP менее загадочным:","Такое поведение не ожидается, и в сочетании с некоторыми нестандартными тестовыми серверами это может привести к тому, что v2ray и VMess показывают FullCone, который на самом деле не работает.","Текущий Mux, также из-за структуры протокола","Теперь перейдем к основной теме - деталям UDP в Xray-core и некоторых прокси-протоколах. Xray-core поддерживает как FullCone, так и Symmetric режимы, и предоставляет очень широкую поддержку протоколов, что делает его идеальным примером. Поддержка FullCone реализована для:","Эти два термина относятся к поведению NAT, где NAT означает Network Address Translation, то есть преобразование сетевых адресов, которое выполняется вашим домашним маршрутизатором и провайдерами на всех уровнях: преобразование адресов. Широкое распространение NAT обусловлено нехваткой адресов IPv4, а также тем, что он может защищать устройства в локальной сети. Для TCP поведение NAT не так важно, поскольку TCP представляет собой двусторонний поток, и при каждом установлении TCP-соединения обычно используется новый временный порт, что соответствует новому пятиэлементному набору. Однако для UDP поведение NAT крайне важно, так как UDP представляет собой пакеты с неопределенным направлением, и очень распространено использование одного и того же локального UDP-порта для отправки пакетов разным целевым двуэлементным наборам. Двуэлементный набор: IP и Port, любое отличие рассматривается как разные двуэлементные наборы Так как же маршрутизатор должен перенаправлять UDP-пакеты, когда они достигают его? Это зависит от поведения NAT маршрутизатора. На самом деле существует множество видов поведения NAT, но давайте рассмотрим наиболее представительные случаи. Для начала представим следующие сценарии:","Эти четыре классических типа включают:"]},{"l":"Как Xray-core реализует протокол прокси с FullCone","p":["Freedom на выходе использует случайный порт для отправки оригинального пейлоада на его исходную цель M, предположим, что Freedom использует двуэлементный набор A1.","REDIRECT изменяет целевой двуэлементный набор UDP-пакетов, и в этом случае Linux не предоставляет механизм, позволяющий программе-прокси узнать исходный адрес назначения UDP-пакета.","Socks на входе получает Socks UDP-пакет от двуэлементного набора A, который содержит оригинальный пейлоад и его исходную цель M, и направляет его в Freedom на выходе.","TPROXY работает наоборот: он не изменяет UDP-пакеты, и Linux предоставляет простой механизм, позволяющий программе-прокси узнать исходный адрес назначения UDP-пакета.","Аналогично, если Freedom с A1 получает пакет от N, Socks отправит оригинальный пейлоад и информацию о N обратно к A.","Вход Shadowsocks на сервере получает Shadowsocks UDP-пакет от клиентского выхода Shadowsocks, расшифровывает его, и дальнейший процесс идентичен описанному выше.","Давайте рассмотрим самый простой сценарий: Socks на входе + Freedom на выходе.","Если вы тестируете NAT прозрачного прокси в Windows, обязательно установите текущую сеть как \"Частную сеть\". Это распространенная ошибка, на которую многие уже наступили, включая меня.","Когда необходимо отправить пакет обратно, программное обеспечение-прокси сначала создает локальный сокет, имитирующий \"исходный двуэлементный набор источника возвращаемого UDP-пакета\", и использует этот сокет для отправки пакета обратно. Это и есть принцип, из-за которого может возникнуть ошибка \"слишком много открытых файлов\". По сравнению с другим программным обеспечением, Xray-core имеет специальные оптимизации для этой ситуации, обеспечивая более элегантное и производительное решение.","на самом деле, принцип довольно прост: он отображает один из ваших локальных UDP-портов на UDP-порт VPS, обеспечивая им одинаковое поведение.","Отдельно стоит упомянуть о QUIC: когда активирован XTLS в Xray-core, трафик, идущий на UDP-порт 443, по умолчанию блокируется (блокировка QUIC), так что приложения не будут использовать QUIC, а будут использовать TLS, благодаря чему XTLS будет действительно работать. На самом деле, QUIC сам по себе не подходит для проксирования, так как он уже включает в себя функции TCP, и использование UoT в этом случае означало бы двойное использование TCP.","Отношение отображения уже установлено, и в течение некоторого времени Socks на входе снова получает прокси-пакет от A, и Freedom продолжит отправлять его на цель, используя A1.","Почему для прозрачного проксирования UDP предпочтительнее использовать TPROXY, а не REDIRECT?","Почему же VMess, который также использует UoT, не может реализовать FullCone? Основная причина заключается в том, что структура протокола UoT VMess позволяет передать \"цель\" только в самом начале, а последующие пакеты могут передавать только \"пейлоад\" без \"цели\". Сервер будет отправлять все последующие пакеты на исходную \"цель\". Сервер отправляет пакеты обратно клиенту по той же логике: структура протокола содержит только \"пейлоад\", и клиент будет считать, что все возвращенные пакеты исходят из первоначальной \"цели\". Это продолжение проблемы дизайна v2ray, и, конечно, встроенный Mux работает таким же образом. (VLESS также затрагивается, но уже в процессе изменений).","Принцип прозрачного проксирования UDP через TPROXY заключается в следующем: чтобы использовать Xray-core для реализации FullCone для игровых консолей, обычно требуется Linux-устройство для настройки прозрачного прокси, например, Raspberry Pi.","Протокол Trojan для UDP работает по аналогичному принципу, но каждый исходный двуэлементный набор соответствует одному TCP-соединению, по которому передается \"пейлоад и цель\" UDP.","Разумеется, для достижения FullCone вызывающей стороне необходимо правильно использовать протокол прокси Socks, и обычно реализации tun2socks работают без проблем.","Таким образом, для VMess, Mux и VLESS Xray-core в настоящее время использует маршрутизацию по принципу Symmetric. В противном случае, если использовать режим FullCone, последующие пакеты будут отправляться на адрес первого пакета, что является проблемой Clash с VMess, но это сложно исправить. Кроме того, когда такая проблема существует, VMess может быть ошибочно идентифицирован как FullCone, что неверно.","Теперь добавим в сценарий Shadowsocks на входе и выходе:","Трафик направляется на выход Shadowsocks, который также использует случайный порт для отправки зашифрованного \"пейлоада и цели\" на серверный вход Shadowsocks."]}],[{"l":"Как мы находим BitTorrent трафик"},{"l":"Как определяется BitTorrent","p":["Сегодня мы рассмотрим как Xray-core определяет BitTorrent трафик на уровне пакетов и заголовков. В нашем арсенале имеется две функции:"]},{"l":"Функция SniffBittorrent","p":["Эта функция предназначена для определения, является ли трафик BitTorrent-трафиком. Она анализирует начало пакета данных:","Проверка длины: Если длина входного массива байтов b меньше 20, функция возвращает ошибку, что указывает на недостаточность данных для анализа.","Анализ заголовка: Функция проверяет, начинаются ли данные с байта 19(что соответствует длине строки \"BitTorrent protocol\"), за которым следует сама строка \"BitTorrent protocol\". Это стандартный заголовок для BitTorrent-соединений.","Результат:","Если условия выполняются, функция возвращает объект SniffHeader, подтверждая, что это BitTorrent-трафик.","Если условия не выполняются, возвращается ошибка errNotBittorrent."]},{"l":"Пример","p":["Допустим, у нас есть пакет данных b, и первые 20 байтов этого пакета выглядят так: [19, 'B', 'i', 't', 'T', 'o', 'r', 'r', 'e', 'n', 't', ' ', 'p', 'r', 'o', 't', 'o', 'c', 'o', 'l']. Функция SniffBittorrent идентифицирует это как BitTorrent-трафик."]},{"l":"Функция SniffUTP"},{"l":"Цель Функции","p":["Функция SniffUTP предназначена для анализа трафика UTP (Micro Transport Protocol), который часто используется для передачи данных в BitTorrent-сетях."]},{"l":"Алгоритм Функции","p":["Проверка Длины Данных:","Первым шагом функция проверяет, достаточна ли длина входного массива байтов b. Если длина меньше 20 байтов, функция не может достоверно анализировать данные, и возвращает ошибку common.ErrNoClue.","Создание Буфера:","Функция создает буфер buffer из входного массива байтов b для удобства чтения данных.","Чтение Типа и Версии:","Считывается один байт, который содержит информацию о типе пакета и версии протокола UTP. Этот байт разбивается на две части: 4 бита для версии ( b[0] 4 0xF) и 4 бита для типа ( b[0] 0xF).","Если версия больше 4 или тип не равен 1, предполагается, что это не UTP-трафик, и возвращается ошибка errNotBittorrent.","Чтение Расширения:","Затем считывается ещё один байт, который указывает на наличие расширений. Если расширение не равно 0 или 1, считается, что это не UTP-трафик, и возвращается ошибка errNotBittorrent.","Анализ Расширений:","Если расширение присутствует, функция продолжает читать дополнительные байты, представляющие расширения, до тех пор, пока не найдет байт расширения, равный 0, что указывает на конец заголовка расширений.","Чтение Временной Метки:","После прохождения всех расширений функция читает 32-битное значение временной метки и сравнивает его с текущим временем. Если разница во времени превышает 24 часа, предполагается, что это не BitTorrent-трафик, и возвращается ошибка errNotBittorrent."]},{"l":"Результат Функции","p":["Если все проверки пройдены успешно, функция возвращает объект SniffHeader, указывающий на потенциальный BitTorrent-трафик через UTP.","В противном случае возвращается соответствующая ошибка."]}],[{"l":"Про фрагментацию"},{"l":"TLS","p":["Протокол TLS обеспечивает конфиденциальность, подлинность и целостность интернет-трафика в клиент-серверной среде. Хотя TLS может шифровать произвольные данные приложений, он преимущественно используется для шифрования HTTP-соединений. Google Chrome сообщает, что около 93% его соединений осуществляются через HTTPS (HTTP+TLS). Шифрование HTTP делает соединения HTTPS устойчивыми к анализу цензоров таких полей, как заголовок Host HTTP. Однако, прежде чем TLS может передавать зашифрованные данные приложений, он выполняет так называемое \"рукопожатие\". Это незашифрованное рукопожатие содержит указание имени сервера (SNI), которое отражает содержимое заголовка Host HTTP. Рукопожатие изображено ниже. Цензоры по всему миру используют расширение SNI для облегчения цензуры HTTPS-соединений. В качестве контрмеры IETF предложила ESNI и ECH. Оба эти метода шифруют расширение SNI в сообщении ClientHello. К сожалению, стандарт все еще находится в стадии разработки, и его распространение далеко от широкого. Единственный сайт, для которого мы смогли найти действующую конфигурацию ECH, - это тестовый сервер Cloudflare. Медленное внедрение ECH требует промежуточных решений для обхода цензуры SNI. Одним из таких решений является фрагментация сообщений TLS на несколько фрагментов TCP, известная как фрагментация TCP."]},{"l":"Фрагментация TCP","p":["TCP - это протокол, основанный на потоках, через который пользователи и приложения могут отправлять данные, используя абстрактные потоки данных. Эти потоки данных преобразуются TCP в фактические сетевые пакеты, называемые сегментами TCP. Каждый сегмент TCP может содержать либо полные сообщения приложений, либо только их части. Последнее называется фрагментацией TCP. Интересно, что фрагментацию TCP можно использовать для обхода цензуры, так как она усложняет анализ трафика. В приведенном выше примере цензор должен объединить оба фрагмента TCP, чтобы правильно идентифицировать назначение запроса GET. Это фактически заставляет цензора поддерживать состояние и выделять дорогостоящую память для анализа каждого соединения. Из-за затрат на анализ фрагментации TCP многие цензоры в прошлом игнорировали ее. Поскольку она оказалась успешной, фрагментацию TCP реализовали в различных инструментах обхода цензуры. Однако недавно китайский цензор стал более продвинутым и начал обрабатывать фрагментацию TCP."]},{"l":"Фрагментация записей TLS","p":["Хотя сообщения TLS могут быть фрагментированы на несколько сегментов TCP, они также могут быть фрагментированы на уровне TLS. Это возможно, потому что слой TLS состоит из двух разных уровней: уровня сообщений TLS и уровня записей TLS. На уровне записей TLS каждое сообщение TLS обернуто в структуру записи TLS. Самое важное, что одно сообщение TLS может быть разделено на несколько записей TLS, что приводит к фрагментации записей TLS. В этом примере расширение SNI разделено на разные записи TLS. Подобно фрагментации TCP, это заставляет цензора поддерживать состояние и выделять память для потенциальной пересборки. Насколько нам известно, фрагментацию записей TLS была предложена для обхода цензуры только Томасом Порнином с 2014 года. Мы не знаем ни об одном анализе или реализации фрагментации записей TLS как техники обхода цензуры. Сегодня мы преодолеваем этот разрыв и эффективно вновь открываем фрагментацию записей TLS как жизнеспособную технику обхода цензуры."]}]]