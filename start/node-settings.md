---
order: 994
label: Настройки узла
icon: apps
---

**Marzban Node** - это приложение на Python, предоставляющее сервис для управления экземпляром ядра Xray. Оно использует RPyC для удаленных вызовов процедур и Docker для контейнеризации. Приложение разработано с учетом требований безопасности и использует самоподписанные SSL-сертификаты для связи между сервисом и его клиентами. Приложение состоит из нескольких Python-скриптов и конфигурационных файлов:

С помощью этого руководства вы можете создать узел Marzban Node на дополнительном сервере и подключить его к панели.

Приложение состоит из нескольких Python-скриптов и конфигурационных файлов:

* `certificate.py`: Python-скрипт для генерации самоподписанного SSL-сертификата.
* `config.py`: Python-скрипт для загрузки переменных окружения и установки значений по умолчанию для некоторых параметров.
* `docker-compose.yml`: Файл Docker Compose для определения и управления сервисами приложения.
* `logger.py`: Python-скрипт для настройки логгера для приложения.
* `main.py`: Основная точка входа в приложение. Он устанавливает сервер RPyC с SSL-аутентификацией и запускает его.
* `service.py`: Python-скрипт, определяющий RPyC-сервис для управления экземпляром ядра Xray.
* `xray.py`: Python-скрипт, определяющий класс для управления экземпляром ядра Xray.

## Установка узла на сервер
В связи с изменением принципа взаимодействия между **Центральной панелью** и **Узлом**, и переходом на **mTLS**, алгоритм подключения узла к центральной панели теперь отличается от уже всеми нами привычного.
### Отличие TLS от mTLS 
старый **TLS**
![](/static/tls.jpg)
новый **mTLS**
![](/static/mtls.jpg)
### Получение ключа Центральной панели
Открываем **настройка узлов** и переходим в меню **добавление нового узла**.

![](/static/node_connect.png)

Скачиваем сертификат в файловую систему вашего устройства по нажатию на кнопку **скачать сертификат**
![](/static/node_download.png)
или, как еще один вариант, вы можете нажать значок **просмотреть** и скопировать полученное значение.
![](/static/node_show.png)

Теперь переходим на наш узел. 

### Настройка узла

Обновляем сервер

```bash
sudo apt-get update && sudo apt-get upgrade
```

Устанавливаем нужный софт

```bash
apt install socat -y && apt install curl socat -y && apt install git -y
```

Клонируем репозиторий

```bash
git clone https://github.com/Gozargah/Marzban-node
```

Входим в рабочую папку узла

```bash
cd Marzban-node
```

Устанавливаем Docker

```bash
curl -fsSL https://get.docker.com | sh
```

Теперь нам необходимо разместить ключ центальной панели на узле, для этого мы можем скопировать ранее полученный ключ по пути `/var/lib/marzban-node/ssl_client_cert.pem`

если Вы скопировали значение ключа ранее просто вставив его в нужный файл.
```bash
nano /var/lib/marzban-node/ssl_client_cert.pem
```

![](/static/node6.jpg)

После этого, теперь, Вы сможете запустить узел.

```bash
docker compose up -d
```

Теперь вернемся в основную панель

## Настройка панели 

Открываем настройки узлов

![](/static/node_add.png)

Заполняем данные узла:

* Name - Имя узла;
* Adress - IP адрес/домен/поддомен узла.
* Port - Оставляем по умолчанию, если не изменяли их.

Оставляем галку, если хотим добавить узел в качестве нового хоста во все входящие


Жмем `Добавить узел`

Если Вы не нажали галку `добавить узел в качестве нового хоста во все входящие`, Вы всегда сможете добавить узел в любой inbound, после ее подключения, просто указав ее адрес (IP или домен/суб-домен)